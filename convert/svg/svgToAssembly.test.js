import { svgToAssembly } from './svgToAssembly';
import { canonicalize as canonicalizePaths } from '@jsxcad/algorithm-paths';
import { writeFileSync } from 'fs';
import { pathsToPdf } from '@jsxcad/convert-pdf';
import { test } from 'ava';

const canonicalize = (assembly) =>
  assembly.map(entry => {
    const copy = Object.assign({}, entry);
    if (copy.paths) {
      copy.paths = canonicalizePaths(copy.paths);
    }
    return copy;
  });

const assemblyToPaths = (assembly) =>
  [].concat(...assembly.map(entry => entry.paths).filter(paths => paths !== undefined));

test('Rectangle', t => {
  const assembly = svgToAssembly({},
                                 `
                                  <?xml version="1.0"?>
                                  <svg width="12cm" height="4cm" viewBox="0 0 1200 400"
                                       xmlns="http://www.w3.org/2000/svg" version="1.2" baseProfile="tiny">
                                    <desc>Example rect01 - rectangle with sharp corners</desc>
                                    <!-- Show outline of canvas using 'rect' element -->
                                    <rect x="1" y="1" width="1198" height="398"
                                          fill="none" stroke="blue" stroke-width="2"/>
                                    <rect x="400" y="100" width="400" height="200"
                                          fill="yellow" stroke="navy" stroke-width="10"  />
                                  </svg>
                                 `);
  writeFileSync('test.rectangle.pdf', pathsToPdf({}, assemblyToPaths(assembly)));
  t.deepEqual(canonicalize(assembly),
              [{ 'paths': [[[0.1, -0.1, 0], [0.12182, -0.1, 0], [0.29434, -0.1, 0], [0.63412, -0.1, 0], [1.13568, -0.1, 0], [1.79353, -0.1, 0], [2.60219, -0.1, 0], [3.55618, -0.1, 0], [4.65001, -0.1, 0], [5.8782, -0.1, 0], [7.23527, -0.1, 0], [8.71572, -0.1, 0], [10.31408, -0.1, 0], [12.02486, -0.1, 0], [13.84258, -0.1, 0], [16.75768, -0.1, 0], [20.96757, -0.1, 0], [25.5065, -0.1, 0], [30.3306, -0.1, 0], [35.396, -0.1, 0], [40.65882, -0.1, 0], [46.07519, -0.1, 0], [54.39169, -0.1, 0], [65.60831, -0.1, 0], [73.92481, -0.1, 0], [79.34119, -0.1, 0], [84.60401, -0.1, 0], [89.6694, -0.1, 0], [94.4935, -0.1, 0], [99.03243, -0.1, 0], [103.24232, -0.1, 0], [106.15742, -0.1, 0], [107.97514, -0.1, 0], [109.68592, -0.1, 0], [111.28428, -0.1, 0], [112.76473, -0.1, 0], [114.1218, -0.1, 0], [115.34999, -0.1, 0], [116.44382, -0.1, 0], [117.39781, -0.1, 0], [118.20647, -0.1, 0], [118.86432, -0.1, 0], [119.36588, -0.1, 0], [119.70566, -0.1, 0], [119.87818, -0.1, 0], [119.9, -0.1, 0], [119.9, -0.12885, 0], [119.9, -0.35415, 0], [119.9, -0.7908, 0], [119.9, -1.42422, 0], [119.9, -2.23982, 0], [119.9, -3.22304, 0], [119.9, -4.3593, 0], [119.9, -5.63402, 0], [119.9, -7.03263, 0], [119.9, -8.54056, 0], [119.9, -10.97552, 0], [119.9, -14.46871, 0], [119.9, -18.1368, 0], [119.9, -21.8632, 0], [119.9, -25.53129, 0], [119.9, -29.02448, 0], [119.9, -31.45944, 0], [119.9, -32.96737, 0], [119.9, -34.36598, 0], [119.9, -35.6407, 0], [119.9, -36.77696, 0], [119.9, -37.76018, 0], [119.9, -38.57578, 0], [119.9, -39.2092, 0], [119.9, -39.64585, 0], [119.9, -39.87115, 0], [119.9, -39.9, 0], [119.87818, -39.9, 0], [119.70566, -39.9, 0], [119.36588, -39.9, 0], [118.86432, -39.9, 0], [118.20647, -39.9, 0], [117.39781, -39.9, 0], [116.44382, -39.9, 0], [115.34999, -39.9, 0], [114.1218, -39.9, 0], [112.76473, -39.9, 0], [111.28428, -39.9, 0], [109.68592, -39.9, 0], [107.97514, -39.9, 0], [106.15742, -39.9, 0], [103.24232, -39.9, 0], [99.03243, -39.9, 0], [94.4935, -39.9, 0], [89.6694, -39.9, 0], [84.60401, -39.9, 0], [79.34119, -39.9, 0], [73.92481, -39.9, 0], [65.60831, -39.9, 0], [54.39169, -39.9, 0], [46.07519, -39.9, 0], [40.65882, -39.9, 0], [35.396, -39.9, 0], [30.3306, -39.9, 0], [25.5065, -39.9, 0], [20.96757, -39.9, 0], [16.75768, -39.9, 0], [13.84258, -39.9, 0], [12.02486, -39.9, 0], [10.31408, -39.9, 0], [8.71572, -39.9, 0], [7.23527, -39.9, 0], [5.8782, -39.9, 0], [4.65001, -39.9, 0], [3.55618, -39.9, 0], [2.60219, -39.9, 0], [1.79353, -39.9, 0], [1.13568, -39.9, 0], [0.63412, -39.9, 0], [0.29434, -39.9, 0], [0.12182, -39.9, 0], [0.1, -39.9, 0], [0.1, -39.87115, 0], [0.1, -39.64585, 0], [0.1, -39.2092, 0], [0.1, -38.57578, 0], [0.1, -37.76018, 0], [0.1, -36.77696, 0], [0.1, -35.6407, 0], [0.1, -34.36598, 0], [0.1, -32.96737, 0], [0.1, -31.45944, 0], [0.1, -29.02448, 0], [0.1, -25.53129, 0], [0.1, -21.8632, 0], [0.1, -18.1368, 0], [0.1, -14.46871, 0], [0.1, -10.97552, 0], [0.1, -8.54056, 0], [0.1, -7.03263, 0], [0.1, -5.63402, 0], [0.1, -4.3593, 0], [0.1, -3.22304, 0], [0.1, -2.23982, 0], [0.1, -1.42422, 0], [0.1, -0.7908, 0], [0.1, -0.35415, 0], [0.1, -0.12885, 0]]] },
               { 'paths': [[[40, -10, 0], [40.02899, -10, 0], [40.25543, -10, 0], [40.69428, -10, 0], [41.33087, -10, 0], [42.15057, -10, 0], [43.13873, -10, 0], [44.2807, -10, 0], [45.56183, -10, 0], [46.96747, -10, 0], [48.48297, -10, 0], [50.93018, -10, 0], [54.44092, -10, 0], [58.12744, -10, 0], [61.87256, -10, 0], [65.55908, -10, 0], [69.06982, -10, 0], [71.51703, -10, 0], [73.03253, -10, 0], [74.43817, -10, 0], [75.7193, -10, 0], [76.86127, -10, 0], [77.84943, -10, 0], [78.66913, -10, 0], [79.30573, -10, 0], [79.74457, -10, 0], [79.97101, -10, 0], [80, -10, 0], [80, -10.0145, 0], [80, -10.12772, 0], [80, -10.49439, 0], [80, -11.31226, 0], [80, -12.45239, 0], [80, -13.8562, 0], [80, -15.46509, 0], [80, -18.13477, 0], [80, -21.86523, 0], [80, -24.53491, 0], [80, -26.1438, 0], [80, -27.54761, 0], [80, -28.68774, 0], [80, -29.50562, 0], [80, -29.87228, 0], [80, -29.9855, 0], [80, -30, 0], [79.97101, -30, 0], [79.74457, -30, 0], [79.30573, -30, 0], [78.66913, -30, 0], [77.84943, -30, 0], [76.86127, -30, 0], [75.7193, -30, 0], [74.43817, -30, 0], [73.03253, -30, 0], [71.51703, -30, 0], [69.06982, -30, 0], [65.55908, -30, 0], [61.87256, -30, 0], [58.12744, -30, 0], [54.44092, -30, 0], [50.93018, -30, 0], [48.48297, -30, 0], [46.96747, -30, 0], [45.56183, -30, 0], [44.2807, -30, 0], [43.13873, -30, 0], [42.15057, -30, 0], [41.33087, -30, 0], [40.69428, -30, 0], [40.25543, -30, 0], [40.02899, -30, 0], [40, -30, 0], [40, -29.9855, 0], [40, -29.87228, 0], [40, -29.50562, 0], [40, -28.68774, 0], [40, -27.54761, 0], [40, -26.1438, 0], [40, -24.53491, 0], [40, -21.86523, 0], [40, -18.13477, 0], [40, -15.46509, 0], [40, -13.8562, 0], [40, -12.45239, 0], [40, -11.31226, 0], [40, -10.49439, 0], [40, -10.12772, 0], [40, -10.0145, 0]]] }]);
});

test('Rounded Rectangle', t => {
  const assembly = svgToAssembly({},
                                 `
                                  <?xml version="1.0"?>
                                  <svg width="12cm" height="4cm" viewBox="0 0 1200 400"
                                       xmlns="http://www.w3.org/2000/svg" version="1.2" baseProfile="tiny">
                                    <desc>Example rect02 - rounded rectangles</desc>
                                    <!-- Show outline of canvas using 'rect' element -->
                                    <rect x="1" y="1" width="1198" height="398"
                                          fill="none" stroke="blue" stroke-width="2"/>
                                    <rect x="100" y="100" width="400" height="200" rx="50"
                                          fill="green" />
                                    <!--<g transform="translate(700 210) rotate(-30)">-->
                                    <g transform="translate(700 210) rotate(-30)">
                                      <rect x="0" y="0" width="400" height="200" rx="50"
                                            fill="none" stroke="purple" stroke-width="30" />
                                    </g>
                                    <g transform="translate(700 210) rotate(-60)">
                                      <rect x="0" y="0" width="400" height="200" rx="50"
                                            fill="none" stroke="purple" stroke-width="30" />
                                    </g>
                                  </svg>
                                 `);
  writeFileSync('test.rounded-rectangle.pdf', pathsToPdf({}, assemblyToPaths(assembly)));
  t.deepEqual(canonicalize(assembly),
              [{ 'paths': [[[0.1, -0.1, 0], [0.12182, -0.1, 0], [0.29434, -0.1, 0], [0.63412, -0.1, 0], [1.13568, -0.1, 0], [1.79353, -0.1, 0], [2.60219, -0.1, 0], [3.55618, -0.1, 0], [4.65001, -0.1, 0], [5.8782, -0.1, 0], [7.23527, -0.1, 0], [8.71572, -0.1, 0], [10.31408, -0.1, 0], [12.02486, -0.1, 0], [13.84258, -0.1, 0], [16.75768, -0.1, 0], [20.96757, -0.1, 0], [25.5065, -0.1, 0], [30.3306, -0.1, 0], [35.396, -0.1, 0], [40.65882, -0.1, 0], [46.07519, -0.1, 0], [54.39169, -0.1, 0], [65.60831, -0.1, 0], [73.92481, -0.1, 0], [79.34119, -0.1, 0], [84.60401, -0.1, 0], [89.6694, -0.1, 0], [94.4935, -0.1, 0], [99.03243, -0.1, 0], [103.24232, -0.1, 0], [106.15742, -0.1, 0], [107.97514, -0.1, 0], [109.68592, -0.1, 0], [111.28428, -0.1, 0], [112.76473, -0.1, 0], [114.1218, -0.1, 0], [115.34999, -0.1, 0], [116.44382, -0.1, 0], [117.39781, -0.1, 0], [118.20647, -0.1, 0], [118.86432, -0.1, 0], [119.36588, -0.1, 0], [119.70566, -0.1, 0], [119.87818, -0.1, 0], [119.9, -0.1, 0], [119.9, -0.12885, 0], [119.9, -0.35415, 0], [119.9, -0.7908, 0], [119.9, -1.42422, 0], [119.9, -2.23982, 0], [119.9, -3.22304, 0], [119.9, -4.3593, 0], [119.9, -5.63402, 0], [119.9, -7.03263, 0], [119.9, -8.54056, 0], [119.9, -10.97552, 0], [119.9, -14.46871, 0], [119.9, -18.1368, 0], [119.9, -21.8632, 0], [119.9, -25.53129, 0], [119.9, -29.02448, 0], [119.9, -31.45944, 0], [119.9, -32.96737, 0], [119.9, -34.36598, 0], [119.9, -35.6407, 0], [119.9, -36.77696, 0], [119.9, -37.76018, 0], [119.9, -38.57578, 0], [119.9, -39.2092, 0], [119.9, -39.64585, 0], [119.9, -39.87115, 0], [119.9, -39.9, 0], [119.87818, -39.9, 0], [119.70566, -39.9, 0], [119.36588, -39.9, 0], [118.86432, -39.9, 0], [118.20647, -39.9, 0], [117.39781, -39.9, 0], [116.44382, -39.9, 0], [115.34999, -39.9, 0], [114.1218, -39.9, 0], [112.76473, -39.9, 0], [111.28428, -39.9, 0], [109.68592, -39.9, 0], [107.97514, -39.9, 0], [106.15742, -39.9, 0], [103.24232, -39.9, 0], [99.03243, -39.9, 0], [94.4935, -39.9, 0], [89.6694, -39.9, 0], [84.60401, -39.9, 0], [79.34119, -39.9, 0], [73.92481, -39.9, 0], [65.60831, -39.9, 0], [54.39169, -39.9, 0], [46.07519, -39.9, 0], [40.65882, -39.9, 0], [35.396, -39.9, 0], [30.3306, -39.9, 0], [25.5065, -39.9, 0], [20.96757, -39.9, 0], [16.75768, -39.9, 0], [13.84258, -39.9, 0], [12.02486, -39.9, 0], [10.31408, -39.9, 0], [8.71572, -39.9, 0], [7.23527, -39.9, 0], [5.8782, -39.9, 0], [4.65001, -39.9, 0], [3.55618, -39.9, 0], [2.60219, -39.9, 0], [1.79353, -39.9, 0], [1.13568, -39.9, 0], [0.63412, -39.9, 0], [0.29434, -39.9, 0], [0.12182, -39.9, 0], [0.1, -39.9, 0], [0.1, -39.87115, 0], [0.1, -39.64585, 0], [0.1, -39.2092, 0], [0.1, -38.57578, 0], [0.1, -37.76018, 0], [0.1, -36.77696, 0], [0.1, -35.6407, 0], [0.1, -34.36598, 0], [0.1, -32.96737, 0], [0.1, -31.45944, 0], [0.1, -29.02448, 0], [0.1, -25.53129, 0], [0.1, -21.8632, 0], [0.1, -18.1368, 0], [0.1, -14.46871, 0], [0.1, -10.97552, 0], [0.1, -8.54056, 0], [0.1, -7.03263, 0], [0.1, -5.63402, 0], [0.1, -4.3593, 0], [0.1, -3.22304, 0], [0.1, -2.23982, 0], [0.1, -1.42422, 0], [0.1, -0.7908, 0], [0.1, -0.35415, 0], [0.1, -0.12885, 0]]] },
               { 'paths': [[[15, -10, 0], [15.02174, -10, 0], [15.19157, -10, 0], [15.52071, -10, 0], [15.99815, -10, 0], [16.61293, -10, 0], [17.35405, -10, 0], [18.67859, -10, 0], [20.7843, -10, 0], [23.19763, -10, 0], [27.20215, -10, 0], [32.79785, -10, 0], [36.80237, -10, 0], [39.2157, -10, 0], [41.32141, -10, 0], [42.64595, -10, 0], [43.38707, -10, 0], [44.00185, -10, 0], [44.47929, -10, 0], [44.80843, -10, 0], [44.97826, -10, 0], [45, -10, 0], [45.2573, -10.00651, 0], [45.76145, -10.05761, 0], [46.24958, -10.15741, 0], [46.71917, -10.3034, 0], [47.16771, -10.49305, 0], [47.59268, -10.72387, 0], [47.99158, -10.99332, 0], [48.36189, -11.29891, 0], [48.70109, -11.63811, 0], [49.00668, -12.00842, 0], [49.27613, -12.40732, 0], [49.50695, -12.83229, 0], [49.6966, -13.28083, 0], [49.84259, -13.75042, 0], [49.94239, -14.23855, 0], [49.99349, -14.7427, 0], [50, -15, 0], [50, -15.02869, 0], [50, -15.24719, 0], [50, -15.65613, 0], [50, -16.2262, 0], [50, -17.31934, 0], [50, -19.06738, 0], [50, -20.93262, 0], [50, -22.68066, 0], [50, -23.7738, 0], [50, -24.34387, 0], [50, -24.75281, 0], [50, -24.97131, 0], [50, -25, 0], [49.99349, -25.2573, 0], [49.94239, -25.76145, 0], [49.84259, -26.24958, 0], [49.6966, -26.71917, 0], [49.50695, -27.16771, 0], [49.27613, -27.59268, 0], [49.00668, -27.99158, 0], [48.70109, -28.36189, 0], [48.36189, -28.70109, 0], [47.99158, -29.00668, 0], [47.59268, -29.27613, 0], [47.16771, -29.50695, 0], [46.71917, -29.6966, 0], [46.24958, -29.84259, 0], [45.76145, -29.94239, 0], [45.2573, -29.99349, 0], [45, -30, 0], [44.97826, -30, 0], [44.80843, -30, 0], [44.47929, -30, 0], [44.00185, -30, 0], [43.38707, -30, 0], [42.64595, -30, 0], [41.32141, -30, 0], [39.2157, -30, 0], [36.80237, -30, 0], [32.79785, -30, 0], [27.20215, -30, 0], [23.19763, -30, 0], [20.7843, -30, 0], [18.67859, -30, 0], [17.35405, -30, 0], [16.61293, -30, 0], [15.99815, -30, 0], [15.52071, -30, 0], [15.19157, -30, 0], [15.02174, -30, 0], [15, -30, 0], [14.7427, -29.99349, 0], [14.23855, -29.94239, 0], [13.75042, -29.84259, 0], [13.28083, -29.6966, 0], [12.83229, -29.50695, 0], [12.40732, -29.27613, 0], [12.00842, -29.00668, 0], [11.63811, -28.70109, 0], [11.29891, -28.36189, 0], [10.99332, -27.99158, 0], [10.72387, -27.59268, 0], [10.49305, -27.16771, 0], [10.3034, -26.71917, 0], [10.15741, -26.24958, 0], [10.05761, -25.76145, 0], [10.00651, -25.2573, 0], [10, -25, 0], [10, -24.97131, 0], [10, -24.75281, 0], [10, -24.34387, 0], [10, -23.7738, 0], [10, -22.68066, 0], [10, -20.93262, 0], [10, -19.06738, 0], [10, -17.31934, 0], [10, -16.2262, 0], [10, -15.65613, 0], [10, -15.24719, 0], [10, -15.02869, 0], [10, -15, 0], [10.00651, -14.7427, 0], [10.05761, -14.23855, 0], [10.15741, -13.75042, 0], [10.3034, -13.28083, 0], [10.49305, -12.83229, 0], [10.72387, -12.40732, 0], [10.99332, -12.00842, 0], [11.29891, -11.63811, 0], [11.63811, -11.29891, 0], [12.00842, -10.99332, 0], [12.40732, -10.72387, 0], [12.83229, -10.49305, 0], [13.28083, -10.3034, 0], [13.75042, -10.15741, 0], [14.23855, -10.05761, 0], [14.7427, -10.00651, 0]]] },
               { 'paths': [[[74.33013, -18.5, 0], [74.34896, -18.48913, 0], [74.49603, -18.40421, 0], [74.78107, -18.23965, 0], [75.19455, -18.00092, 0], [75.72697, -17.69353, 0], [76.36879, -17.32297, 0], [77.51588, -16.66071, 0], [79.33948, -15.60785, 0], [81.42948, -14.40118, 0], [84.8975, -12.39893, 0], [89.74352, -9.60107, 0], [93.21153, -7.59882, 0], [95.30154, -6.39215, 0], [97.12514, -5.33929, 0], [98.27222, -4.67703, 0], [98.91405, -4.30647, 0], [99.44646, -3.99908, 0], [99.85994, -3.76035, 0], [100.14498, -3.59579, 0], [100.29206, -3.51087, 0], [100.31089, -3.5, 0], [100.53697, -3.37698, 0], [100.99913, -3.16917, 0], [101.47176, -3.01153, 0], [101.95143, -2.90317, 0], [102.43471, -2.84314, 0], [102.91815, -2.83055, 0], [103.39833, -2.86445, 0], [103.87182, -2.94394, 0], [104.33518, -3.0681, 0], [104.78498, -3.236, 0], [105.21779, -3.44673, 0], [105.63017, -3.69936, 0], [106.01868, -3.99298, 0], [106.3799, -4.32667, 0], [106.7104, -4.6995, 0], [107.00673, -5.11055, 0], [107.14102, -5.33013, 0], [107.15536, -5.35497, 0], [107.26461, -5.5442, 0], [107.46908, -5.89835, 0], [107.75411, -6.39204, 0], [108.30068, -7.33873, 0], [109.17471, -8.85258, 0], [110.10732, -10.46792, 0], [110.98135, -11.98178, 0], [111.52792, -12.92846, 0], [111.81295, -13.42216, 0], [112.01742, -13.77631, 0], [112.12667, -13.96554, 0], [112.14102, -13.99038, 0], [112.26403, -14.21646, 0], [112.47185, -14.67862, 0], [112.62948, -15.15125, 0], [112.73785, -15.63092, 0], [112.79787, -16.1142, 0], [112.81047, -16.59764, 0], [112.77656, -17.07783, 0], [112.69707, -17.55132, 0], [112.57291, -18.01468, 0], [112.40501, -18.46448, 0], [112.19428, -18.89728, 0], [111.94165, -19.30966, 0], [111.64803, -19.69817, 0], [111.31435, -20.0594, 0], [110.94152, -20.38989, 0], [110.53046, -20.68622, 0], [110.31089, -20.82051, 0], [110.29206, -20.83138, 0], [110.14498, -20.9163, 0], [109.85994, -21.08086, 0], [109.44646, -21.31959, 0], [108.91405, -21.62697, 0], [108.27222, -21.99753, 0], [107.12514, -22.6598, 0], [105.30154, -23.71266, 0], [103.21153, -24.91932, 0], [99.74352, -26.92158, 0], [94.8975, -29.71943, 0], [91.42948, -31.72169, 0], [89.33948, -32.92836, 0], [87.51588, -33.98121, 0], [86.36879, -34.64348, 0], [85.72697, -35.01404, 0], [85.19455, -35.32143, 0], [84.78107, -35.56016, 0], [84.49603, -35.72472, 0], [84.34896, -35.80964, 0], [84.33013, -35.82051, 0], [84.10405, -35.94352, 0], [83.64189, -36.15134, 0], [83.16925, -36.30897, 0], [82.68958, -36.41734, 0], [82.20631, -36.47736, 0], [81.72287, -36.48996, 0], [81.24268, -36.45606, 0], [80.76919, -36.37656, 0], [80.30583, -36.25241, 0], [79.85603, -36.0845, 0], [79.42323, -35.87378, 0], [79.01085, -35.62114, 0], [78.62234, -35.32752, 0], [78.26111, -34.99384, 0], [77.93062, -34.62101, 0], [77.63428, -34.20996, 0], [77.5, -33.99038, 0], [77.48566, -33.96554, 0], [77.3764, -33.77631, 0], [77.17194, -33.42216, 0], [76.8869, -32.92846, 0], [76.34033, -31.98178, 0], [75.46631, -30.46792, 0], [74.53369, -28.85258, 0], [73.65967, -27.33873, 0], [73.1131, -26.39204, 0], [72.82806, -25.89835, 0], [72.6236, -25.5442, 0], [72.51434, -25.35497, 0], [72.5, -25.33013, 0], [72.37698, -25.10405, 0], [72.16917, -24.64189, 0], [72.01153, -24.16925, 0], [71.90317, -23.68958, 0], [71.84314, -23.20631, 0], [71.83055, -22.72287, 0], [71.86445, -22.24268, 0], [71.94394, -21.76919, 0], [72.0681, -21.30583, 0], [72.236, -20.85603, 0], [72.44673, -20.42323, 0], [72.69936, -20.01085, 0], [72.99298, -19.62234, 0], [73.32667, -19.26111, 0], [73.6995, -18.93062, 0], [74.11055, -18.63428, 0]]] },
               { 'paths': [[[72.5, -16.66987, 0], [72.51087, -16.65104, 0], [72.59579, -16.50397, 0], [72.76035, -16.21893, 0], [72.99908, -15.80545, 0], [73.30647, -15.27303, 0], [73.67703, -14.63121, 0], [74.33929, -13.48412, 0], [75.39215, -11.66052, 0], [76.59882, -9.57052, 0], [78.60107, -6.1025, 0], [81.39893, -1.25648, 0], [83.40118, 2.21153, 0], [84.60785, 4.30154, 0], [85.66071, 6.12514, 0], [86.32298, 7.27222, 0], [86.69354, 7.91405, 0], [87.00092, 8.44646, 0], [87.23965, 8.85994, 0], [87.40421, 9.14498, 0], [87.48913, 9.29206, 0], [87.5, 9.31089, 0], [87.63428, 9.53046, 0], [87.93062, 9.94152, 0], [88.26111, 10.31435, 0], [88.62234, 10.64803, 0], [89.01085, 10.94165, 0], [89.42323, 11.19428, 0], [89.85603, 11.40501, 0], [90.30583, 11.57291, 0], [90.76919, 11.69707, 0], [91.24268, 11.77656, 0], [91.72287, 11.81047, 0], [92.20631, 11.79787, 0], [92.68958, 11.73785, 0], [93.16925, 11.62948, 0], [93.64189, 11.47185, 0], [94.10405, 11.26403, 0], [94.33013, 11.14102, 0], [94.35497, 11.12667, 0], [94.5442, 11.01742, 0], [94.89835, 10.81295, 0], [95.39204, 10.52792, 0], [96.33873, 9.98135, 0], [97.85258, 9.10732, 0], [99.46792, 8.17471, 0], [100.98178, 7.30068, 0], [101.92846, 6.75411, 0], [102.42216, 6.46908, 0], [102.77631, 6.26461, 0], [102.96554, 6.15536, 0], [102.99038, 6.14102, 0], [103.20996, 6.00673, 0], [103.62101, 5.7104, 0], [103.99384, 5.3799, 0], [104.32752, 5.01868, 0], [104.62114, 4.63017, 0], [104.87378, 4.21779, 0], [105.0845, 3.78498, 0], [105.25241, 3.33518, 0], [105.37656, 2.87182, 0], [105.45606, 2.39833, 0], [105.48996, 1.91815, 0], [105.47736, 1.43471, 0], [105.41734, 0.95143, 0], [105.30897, 0.47176, 0], [105.15134, -0.00087, 0], [104.94352, -0.46303, 0], [104.82051, -0.68911, 0], [104.80964, -0.70794, 0], [104.72472, -0.85502, 0], [104.56016, -1.14006, 0], [104.32143, -1.55354, 0], [104.01404, -2.08595, 0], [103.64348, -2.72778, 0], [102.98121, -3.87486, 0], [101.92836, -5.69846, 0], [100.72169, -7.78847, 0], [98.71943, -11.25648, 0], [95.92158, -16.1025, 0], [93.91932, -19.57052, 0], [92.71266, -21.66052, 0], [91.6598, -23.48412, 0], [90.99753, -24.63121, 0], [90.62697, -25.27303, 0], [90.31959, -25.80545, 0], [90.08086, -26.21893, 0], [89.9163, -26.50397, 0], [89.83138, -26.65104, 0], [89.82051, -26.66987, 0], [89.68622, -26.88945, 0], [89.38989, -27.3005, 0], [89.0594, -27.67333, 0], [88.69817, -28.00702, 0], [88.30966, -28.30064, 0], [87.89728, -28.55327, 0], [87.46448, -28.764, 0], [87.01468, -28.9319, 0], [86.55132, -29.05606, 0], [86.07783, -29.13555, 0], [85.59764, -29.16945, 0], [85.1142, -29.15686, 0], [84.63092, -29.09683, 0], [84.15125, -28.98847, 0], [83.67862, -28.83083, 0], [83.21646, -28.62302, 0], [82.99038, -28.5, 0], [82.96554, -28.48566, 0], [82.77631, -28.3764, 0], [82.42216, -28.17194, 0], [81.92846, -27.8869, 0], [80.98178, -27.34033, 0], [79.46792, -26.46631, 0], [77.85258, -25.53369, 0], [76.33873, -24.65967, 0], [75.39204, -24.1131, 0], [74.89835, -23.82806, 0], [74.5442, -23.6236, 0], [74.35497, -23.51434, 0], [74.33013, -23.5, 0], [74.11055, -23.36572, 0], [73.6995, -23.06938, 0], [73.32667, -22.73889, 0], [72.99298, -22.37766, 0], [72.69936, -21.98915, 0], [72.44673, -21.57677, 0], [72.236, -21.14397, 0], [72.0681, -20.69417, 0], [71.94394, -20.23081, 0], [71.86445, -19.75732, 0], [71.83055, -19.27713, 0], [71.84314, -18.79369, 0], [71.90317, -18.31042, 0], [72.01153, -17.83075, 0], [72.16917, -17.35811, 0], [72.37698, -16.89595, 0]]] }]);
});

test('Polyline', t => {
  const assembly = svgToAssembly({},
                                 `
                                  <?xml version="1.0"?>
                                  <svg width="12cm" height="4cm" viewBox="0 0 1200 400"
                                       xmlns="http://www.w3.org/2000/svg" version="1.2" baseProfile="tiny">
                                    <desc>Example polyline01 - increasingly larger bars</desc>
                                    <!-- Show outline of canvas using 'rect' element -->
                                    <rect x="1" y="1" width="1198" height="398"
                                          fill="none" stroke="blue" stroke-width="2" />
                                    <polyline fill="none" stroke="blue" stroke-width="10" 
                                              points="50,375
                                                      150,375 150,325 250,325 250,375
                                                      350,375 350,250 450,250 450,375
                                                      550,375 550,175 650,175 650,375
                                                      750,375 750,100 850,100 850,375
                                                      950,375 950,25 1050,25 1050,375
                                                      1150,375" />
                                  </svg>
                                 `);
  writeFileSync('test.polyline.pdf', pathsToPdf({}, assemblyToPaths(assembly)));
  t.deepEqual(canonicalize(assembly),
              [{ 'paths': [[[0.1, -0.1, 0], [0.12182, -0.1, 0], [0.29434, -0.1, 0], [0.63412, -0.1, 0], [1.13568, -0.1, 0], [1.79353, -0.1, 0], [2.60219, -0.1, 0], [3.55618, -0.1, 0], [4.65001, -0.1, 0], [5.8782, -0.1, 0], [7.23527, -0.1, 0], [8.71572, -0.1, 0], [10.31408, -0.1, 0], [12.02486, -0.1, 0], [13.84258, -0.1, 0], [16.75768, -0.1, 0], [20.96757, -0.1, 0], [25.5065, -0.1, 0], [30.3306, -0.1, 0], [35.396, -0.1, 0], [40.65882, -0.1, 0], [46.07519, -0.1, 0], [54.39169, -0.1, 0], [65.60831, -0.1, 0], [73.92481, -0.1, 0], [79.34119, -0.1, 0], [84.60401, -0.1, 0], [89.6694, -0.1, 0], [94.4935, -0.1, 0], [99.03243, -0.1, 0], [103.24232, -0.1, 0], [106.15742, -0.1, 0], [107.97514, -0.1, 0], [109.68592, -0.1, 0], [111.28428, -0.1, 0], [112.76473, -0.1, 0], [114.1218, -0.1, 0], [115.34999, -0.1, 0], [116.44382, -0.1, 0], [117.39781, -0.1, 0], [118.20647, -0.1, 0], [118.86432, -0.1, 0], [119.36588, -0.1, 0], [119.70566, -0.1, 0], [119.87818, -0.1, 0], [119.9, -0.1, 0], [119.9, -0.12885, 0], [119.9, -0.35415, 0], [119.9, -0.7908, 0], [119.9, -1.42422, 0], [119.9, -2.23982, 0], [119.9, -3.22304, 0], [119.9, -4.3593, 0], [119.9, -5.63402, 0], [119.9, -7.03263, 0], [119.9, -8.54056, 0], [119.9, -10.97552, 0], [119.9, -14.46871, 0], [119.9, -18.1368, 0], [119.9, -21.8632, 0], [119.9, -25.53129, 0], [119.9, -29.02448, 0], [119.9, -31.45944, 0], [119.9, -32.96737, 0], [119.9, -34.36598, 0], [119.9, -35.6407, 0], [119.9, -36.77696, 0], [119.9, -37.76018, 0], [119.9, -38.57578, 0], [119.9, -39.2092, 0], [119.9, -39.64585, 0], [119.9, -39.87115, 0], [119.9, -39.9, 0], [119.87818, -39.9, 0], [119.70566, -39.9, 0], [119.36588, -39.9, 0], [118.86432, -39.9, 0], [118.20647, -39.9, 0], [117.39781, -39.9, 0], [116.44382, -39.9, 0], [115.34999, -39.9, 0], [114.1218, -39.9, 0], [112.76473, -39.9, 0], [111.28428, -39.9, 0], [109.68592, -39.9, 0], [107.97514, -39.9, 0], [106.15742, -39.9, 0], [103.24232, -39.9, 0], [99.03243, -39.9, 0], [94.4935, -39.9, 0], [89.6694, -39.9, 0], [84.60401, -39.9, 0], [79.34119, -39.9, 0], [73.92481, -39.9, 0], [65.60831, -39.9, 0], [54.39169, -39.9, 0], [46.07519, -39.9, 0], [40.65882, -39.9, 0], [35.396, -39.9, 0], [30.3306, -39.9, 0], [25.5065, -39.9, 0], [20.96757, -39.9, 0], [16.75768, -39.9, 0], [13.84258, -39.9, 0], [12.02486, -39.9, 0], [10.31408, -39.9, 0], [8.71572, -39.9, 0], [7.23527, -39.9, 0], [5.8782, -39.9, 0], [4.65001, -39.9, 0], [3.55618, -39.9, 0], [2.60219, -39.9, 0], [1.79353, -39.9, 0], [1.13568, -39.9, 0], [0.63412, -39.9, 0], [0.29434, -39.9, 0], [0.12182, -39.9, 0], [0.1, -39.9, 0], [0.1, -39.87115, 0], [0.1, -39.64585, 0], [0.1, -39.2092, 0], [0.1, -38.57578, 0], [0.1, -37.76018, 0], [0.1, -36.77696, 0], [0.1, -35.6407, 0], [0.1, -34.36598, 0], [0.1, -32.96737, 0], [0.1, -31.45944, 0], [0.1, -29.02448, 0], [0.1, -25.53129, 0], [0.1, -21.8632, 0], [0.1, -18.1368, 0], [0.1, -14.46871, 0], [0.1, -10.97552, 0], [0.1, -8.54056, 0], [0.1, -7.03263, 0], [0.1, -5.63402, 0], [0.1, -4.3593, 0], [0.1, -3.22304, 0], [0.1, -2.23982, 0], [0.1, -1.42422, 0], [0.1, -0.7908, 0], [0.1, -0.35415, 0], [0.1, -0.12885, 0]]] },
               { 'paths': [[null, [5, -37.5, 0], [5.02869, -37.5, 0], [5.24719, -37.5, 0], [5.65613, -37.5, 0], [6.2262, -37.5, 0], [7.31934, -37.5, 0], [9.06738, -37.5, 0], [10.93262, -37.5, 0], [12.68066, -37.5, 0], [13.7738, -37.5, 0], [14.34387, -37.5, 0], [14.75281, -37.5, 0], [14.97131, -37.5, 0], [15, -37.5, 0], [15, -37.48566, 0], [15, -37.3764, 0], [15, -37.03857, 0], [15, -36.34033, 0], [15, -35.46631, 0], [15, -34.53369, 0], [15, -33.65967, 0], [15, -32.96143, 0], [15, -32.6236, 0], [15, -32.51434, 0], [15, -32.5, 0], [15.02869, -32.5, 0], [15.24719, -32.5, 0], [15.65613, -32.5, 0], [16.2262, -32.5, 0], [17.31934, -32.5, 0], [19.06738, -32.5, 0], [20.93262, -32.5, 0], [22.68066, -32.5, 0], [23.7738, -32.5, 0], [24.34387, -32.5, 0], [24.75281, -32.5, 0], [24.97131, -32.5, 0], [25, -32.5, 0], [25, -32.51434, 0], [25, -32.6236, 0], [25, -32.96143, 0], [25, -33.65967, 0], [25, -34.53369, 0], [25, -35.46631, 0], [25, -36.34033, 0], [25, -37.03857, 0], [25, -37.3764, 0], [25, -37.48566, 0], [25, -37.5, 0], [25.02869, -37.5, 0], [25.24719, -37.5, 0], [25.65613, -37.5, 0], [26.2262, -37.5, 0], [27.31934, -37.5, 0], [29.06738, -37.5, 0], [30.93262, -37.5, 0], [32.68066, -37.5, 0], [33.7738, -37.5, 0], [34.34387, -37.5, 0], [34.75281, -37.5, 0], [34.97131, -37.5, 0], [35, -37.5, 0], [35, -37.46414, 0], [35, -37.19101, 0], [35, -36.67984, 0], [35, -35.96725, 0], [35, -35.08987, 0], [35, -34.08432, 0], [35, -32.41577, 0], [35, -30.08423, 0], [35, -28.41568, 0], [35, -27.41013, 0], [35, -26.53274, 0], [35, -25.82016, 0], [35, -25.30899, 0], [35, -25.03586, 0], [35, -25, 0], [35.02869, -25, 0], [35.24719, -25, 0], [35.65613, -25, 0], [36.2262, -25, 0], [37.31934, -25, 0], [39.06738, -25, 0], [40.93262, -25, 0], [42.68066, -25, 0], [43.7738, -25, 0], [44.34387, -25, 0], [44.75281, -25, 0], [44.97131, -25, 0], [45, -25, 0], [45, -25.03586, 0], [45, -25.30899, 0], [45, -25.82016, 0], [45, -26.53274, 0], [45, -27.41013, 0], [45, -28.41568, 0], [45, -30.08423, 0], [45, -32.41577, 0], [45, -34.08432, 0], [45, -35.08987, 0], [45, -35.96725, 0], [45, -36.67984, 0], [45, -37.19101, 0], [45, -37.46414, 0], [45, -37.5, 0], [45.02869, -37.5, 0], [45.24719, -37.5, 0], [45.65613, -37.5, 0], [46.2262, -37.5, 0], [47.31934, -37.5, 0], [49.06738, -37.5, 0], [50.93262, -37.5, 0], [52.68066, -37.5, 0], [53.7738, -37.5, 0], [54.34387, -37.5, 0], [54.75281, -37.5, 0], [54.97131, -37.5, 0], [55, -37.5, 0], [55, -37.4855, 0], [55, -37.37228, 0], [55, -37.00561, 0], [55, -36.18774, 0], [55, -35.04761, 0], [55, -33.6438, 0], [55, -32.03491, 0], [55, -29.36523, 0], [55, -25.63477, 0], [55, -22.96509, 0], [55, -21.3562, 0], [55, -19.95239, 0], [55, -18.81226, 0], [55, -17.99439, 0], [55, -17.62772, 0], [55, -17.5145, 0], [55, -17.5, 0], [55.02869, -17.5, 0], [55.24719, -17.5, 0], [55.65613, -17.5, 0], [56.2262, -17.5, 0], [57.31934, -17.5, 0], [59.06738, -17.5, 0], [60.93262, -17.5, 0], [62.68066, -17.5, 0], [63.7738, -17.5, 0], [64.34387, -17.5, 0], [64.75281, -17.5, 0], [64.97131, -17.5, 0], [65, -17.5, 0], [65, -17.5145, 0], [65, -17.62772, 0], [65, -17.99439, 0], [65, -18.81226, 0], [65, -19.95239, 0], [65, -21.3562, 0], [65, -22.96509, 0], [65, -25.63477, 0], [65, -29.36523, 0], [65, -32.03491, 0], [65, -33.6438, 0], [65, -35.04761, 0], [65, -36.18774, 0], [65, -37.00561, 0], [65, -37.37228, 0], [65, -37.4855, 0], [65, -37.5, 0], [65.02869, -37.5, 0], [65.24719, -37.5, 0], [65.65613, -37.5, 0], [66.2262, -37.5, 0], [67.31934, -37.5, 0], [69.06738, -37.5, 0], [70.93262, -37.5, 0], [72.68066, -37.5, 0], [73.7738, -37.5, 0], [74.34387, -37.5, 0], [74.75281, -37.5, 0], [74.97131, -37.5, 0], [75, -37.5, 0], [75, -37.48007, 0], [75, -37.32439, 0], [75, -37.02269, 0], [75, -36.58503, 0], [75, -36.02148, 0], [75, -35.34212, 0], [75, -34.12796, 0], [75, -32.19772, 0], [75, -29.9855, 0], [75, -26.3147, 0], [75, -21.1853, 0], [75, -17.5145, 0], [75, -15.30228, 0], [75, -13.37204, 0], [75, -12.15788, 0], [75, -11.47852, 0], [75, -10.91497, 0], [75, -10.47731, 0], [75, -10.17561, 0], [75, -10.01993, 0], [75, -10, 0], [75.02869, -10, 0], [75.24719, -10, 0], [75.65613, -10, 0], [76.2262, -10, 0], [77.31934, -10, 0], [79.06738, -10, 0], [80.93262, -10, 0], [82.68066, -10, 0], [83.7738, -10, 0], [84.34387, -10, 0], [84.75281, -10, 0], [84.97131, -10, 0], [85, -10, 0], [85, -10.01993, 0], [85, -10.17561, 0], [85, -10.47731, 0], [85, -10.91497, 0], [85, -11.47852, 0], [85, -12.15788, 0], [85, -13.37204, 0], [85, -15.30228, 0], [85, -17.5145, 0], [85, -21.1853, 0], [85, -26.3147, 0], [85, -29.9855, 0], [85, -32.19772, 0], [85, -34.12796, 0], [85, -35.34212, 0], [85, -36.02148, 0], [85, -36.58503, 0], [85, -37.02269, 0], [85, -37.32439, 0], [85, -37.48007, 0], [85, -37.5, 0], [85.02869, -37.5, 0], [85.24719, -37.5, 0], [85.65613, -37.5, 0], [86.2262, -37.5, 0], [87.31934, -37.5, 0], [89.06738, -37.5, 0], [90.93262, -37.5, 0], [92.68066, -37.5, 0], [93.7738, -37.5, 0], [94.34387, -37.5, 0], [94.75281, -37.5, 0], [94.97131, -37.5, 0], [95, -37.5, 0], [95, -37.47463, 0], [95, -37.2765, 0], [95, -36.89251, 0], [95, -36.33549, 0], [95, -35.61825, 0], [95, -34.75361, 0], [95, -33.75439, 0], [95, -32.6334, 0], [95, -30.75165, 0], [95, -27.9361, 0], [95, -24.8642, 0], [95, -21.63849, 0], [95, -18.36151, 0], [95, -15.1358, 0], [95, -12.0639, 0], [95, -9.24835, 0], [95, -7.3666, 0], [95, -6.24561, 0], [95, -5.24639, 0], [95, -4.38175, 0], [95, -3.66451, 0], [95, -3.10749, 0], [95, -2.7235, 0], [95, -2.52537, 0], [95, -2.5, 0], [95.02869, -2.5, 0], [95.24719, -2.5, 0], [95.65613, -2.5, 0], [96.2262, -2.5, 0], [97.31934, -2.5, 0], [99.06738, -2.5, 0], [100.93262, -2.5, 0], [102.68066, -2.5, 0], [103.7738, -2.5, 0], [104.34387, -2.5, 0], [104.75281, -2.5, 0], [104.97131, -2.5, 0], [105, -2.5, 0], [105, -2.52537, 0], [105, -2.7235, 0], [105, -3.10749, 0], [105, -3.66451, 0], [105, -4.38175, 0], [105, -5.24639, 0], [105, -6.24561, 0], [105, -7.3666, 0], [105, -9.24835, 0], [105, -12.0639, 0], [105, -15.1358, 0], [105, -18.36151, 0], [105, -21.63849, 0], [105, -24.8642, 0], [105, -27.9361, 0], [105, -30.75165, 0], [105, -32.6334, 0], [105, -33.75439, 0], [105, -34.75361, 0], [105, -35.61825, 0], [105, -36.33549, 0], [105, -36.89251, 0], [105, -37.2765, 0], [105, -37.47463, 0], [105, -37.5, 0], [105.02869, -37.5, 0], [105.24719, -37.5, 0], [105.65613, -37.5, 0], [106.2262, -37.5, 0], [107.31934, -37.5, 0], [109.06738, -37.5, 0], [110.93262, -37.5, 0], [112.68066, -37.5, 0], [113.7738, -37.5, 0], [114.34387, -37.5, 0], [114.75281, -37.5, 0], [114.97131, -37.5, 0], [115, -37.5, 0]]] }]);
});

test('Circle', t => {
  const assembly = svgToAssembly({},
                                 `
                                  <?xml version="1.0"?>
                                  <svg width="12cm" height="4cm" viewBox="0 0 1200 400"
                                       xmlns="http://www.w3.org/2000/svg" version="1.2" baseProfile="tiny">
                                    <desc>Example circle01 - circle filled with red and stroked with blue</desc>
                                    <!-- Show outline of canvas using 'rect' element -->
                                    <rect x="1" y="1" width="1198" height="398"
                                          fill="none" stroke="blue" stroke-width="2"/>
                                    <circle cx="600" cy="200" r="100"
                                          fill="red" stroke="blue" stroke-width="10"  />
                                  </svg>
                                 `);
  writeFileSync('test.circle.pdf', pathsToPdf({}, assemblyToPaths(assembly)));
  t.deepEqual(canonicalize(assembly),
              [{ 'paths': [[[0.1, -0.1, 0], [0.12182, -0.1, 0], [0.29434, -0.1, 0], [0.63412, -0.1, 0], [1.13568, -0.1, 0], [1.79353, -0.1, 0], [2.60219, -0.1, 0], [3.55618, -0.1, 0], [4.65001, -0.1, 0], [5.8782, -0.1, 0], [7.23527, -0.1, 0], [8.71572, -0.1, 0], [10.31408, -0.1, 0], [12.02486, -0.1, 0], [13.84258, -0.1, 0], [16.75768, -0.1, 0], [20.96757, -0.1, 0], [25.5065, -0.1, 0], [30.3306, -0.1, 0], [35.396, -0.1, 0], [40.65882, -0.1, 0], [46.07519, -0.1, 0], [54.39169, -0.1, 0], [65.60831, -0.1, 0], [73.92481, -0.1, 0], [79.34119, -0.1, 0], [84.60401, -0.1, 0], [89.6694, -0.1, 0], [94.4935, -0.1, 0], [99.03243, -0.1, 0], [103.24232, -0.1, 0], [106.15742, -0.1, 0], [107.97514, -0.1, 0], [109.68592, -0.1, 0], [111.28428, -0.1, 0], [112.76473, -0.1, 0], [114.1218, -0.1, 0], [115.34999, -0.1, 0], [116.44382, -0.1, 0], [117.39781, -0.1, 0], [118.20647, -0.1, 0], [118.86432, -0.1, 0], [119.36588, -0.1, 0], [119.70566, -0.1, 0], [119.87818, -0.1, 0], [119.9, -0.1, 0], [119.9, -0.12885, 0], [119.9, -0.35415, 0], [119.9, -0.7908, 0], [119.9, -1.42422, 0], [119.9, -2.23982, 0], [119.9, -3.22304, 0], [119.9, -4.3593, 0], [119.9, -5.63402, 0], [119.9, -7.03263, 0], [119.9, -8.54056, 0], [119.9, -10.97552, 0], [119.9, -14.46871, 0], [119.9, -18.1368, 0], [119.9, -21.8632, 0], [119.9, -25.53129, 0], [119.9, -29.02448, 0], [119.9, -31.45944, 0], [119.9, -32.96737, 0], [119.9, -34.36598, 0], [119.9, -35.6407, 0], [119.9, -36.77696, 0], [119.9, -37.76018, 0], [119.9, -38.57578, 0], [119.9, -39.2092, 0], [119.9, -39.64585, 0], [119.9, -39.87115, 0], [119.9, -39.9, 0], [119.87818, -39.9, 0], [119.70566, -39.9, 0], [119.36588, -39.9, 0], [118.86432, -39.9, 0], [118.20647, -39.9, 0], [117.39781, -39.9, 0], [116.44382, -39.9, 0], [115.34999, -39.9, 0], [114.1218, -39.9, 0], [112.76473, -39.9, 0], [111.28428, -39.9, 0], [109.68592, -39.9, 0], [107.97514, -39.9, 0], [106.15742, -39.9, 0], [103.24232, -39.9, 0], [99.03243, -39.9, 0], [94.4935, -39.9, 0], [89.6694, -39.9, 0], [84.60401, -39.9, 0], [79.34119, -39.9, 0], [73.92481, -39.9, 0], [65.60831, -39.9, 0], [54.39169, -39.9, 0], [46.07519, -39.9, 0], [40.65882, -39.9, 0], [35.396, -39.9, 0], [30.3306, -39.9, 0], [25.5065, -39.9, 0], [20.96757, -39.9, 0], [16.75768, -39.9, 0], [13.84258, -39.9, 0], [12.02486, -39.9, 0], [10.31408, -39.9, 0], [8.71572, -39.9, 0], [7.23527, -39.9, 0], [5.8782, -39.9, 0], [4.65001, -39.9, 0], [3.55618, -39.9, 0], [2.60219, -39.9, 0], [1.79353, -39.9, 0], [1.13568, -39.9, 0], [0.63412, -39.9, 0], [0.29434, -39.9, 0], [0.12182, -39.9, 0], [0.1, -39.9, 0], [0.1, -39.87115, 0], [0.1, -39.64585, 0], [0.1, -39.2092, 0], [0.1, -38.57578, 0], [0.1, -37.76018, 0], [0.1, -36.77696, 0], [0.1, -35.6407, 0], [0.1, -34.36598, 0], [0.1, -32.96737, 0], [0.1, -31.45944, 0], [0.1, -29.02448, 0], [0.1, -25.53129, 0], [0.1, -21.8632, 0], [0.1, -18.1368, 0], [0.1, -14.46871, 0], [0.1, -10.97552, 0], [0.1, -8.54056, 0], [0.1, -7.03263, 0], [0.1, -5.63402, 0], [0.1, -4.3593, 0], [0.1, -3.22304, 0], [0.1, -2.23982, 0], [0.1, -1.42422, 0], [0.1, -0.7908, 0], [0.1, -0.35415, 0], [0.1, -0.12885, 0]]] },
               { 'paths': [[[60, -10, 0], [60.5146, -10.01301, 0], [61.5229, -10.11522, 0], [62.49916, -10.31483, 0], [63.43833, -10.6068, 0], [64.33541, -10.98611, 0], [65.18536, -11.44773, 0], [65.98316, -11.98665, 0], [66.72377, -12.59782, 0], [67.40218, -13.27623, 0], [68.01335, -14.01684, 0], [68.55227, -14.81464, 0], [69.01389, -15.66459, 0], [69.3932, -16.56167, 0], [69.68517, -17.50084, 0], [69.88478, -18.4771, 0], [69.98699, -19.4854, 0], [70, -20, 0], [69.98699, -20.5146, 0], [69.88478, -21.5229, 0], [69.68517, -22.49916, 0], [69.3932, -23.43833, 0], [69.01389, -24.33541, 0], [68.55227, -25.18536, 0], [68.01335, -25.98316, 0], [67.40218, -26.72377, 0], [66.72377, -27.40218, 0], [65.98316, -28.01335, 0], [65.18536, -28.55227, 0], [64.33541, -29.01389, 0], [63.43833, -29.3932, 0], [62.49916, -29.68517, 0], [61.5229, -29.88478, 0], [60.5146, -29.98699, 0], [60, -30, 0], [59.4854, -29.98699, 0], [58.4771, -29.88478, 0], [57.50084, -29.68517, 0], [56.56167, -29.3932, 0], [55.66459, -29.01389, 0], [54.81464, -28.55227, 0], [54.01684, -28.01335, 0], [53.27623, -27.40218, 0], [52.59782, -26.72377, 0], [51.98665, -25.98316, 0], [51.44773, -25.18536, 0], [50.98611, -24.33541, 0], [50.6068, -23.43833, 0], [50.31483, -22.49916, 0], [50.11522, -21.5229, 0], [50.01301, -20.5146, 0], [50, -20, 0], [50.01301, -19.4854, 0], [50.11522, -18.4771, 0], [50.31483, -17.50084, 0], [50.6068, -16.56167, 0], [50.98611, -15.66459, 0], [51.44773, -14.81464, 0], [51.98665, -14.01684, 0], [52.59782, -13.27623, 0], [53.27623, -12.59782, 0], [54.01684, -11.98665, 0], [54.81464, -11.44773, 0], [55.66459, -10.98611, 0], [56.56167, -10.6068, 0], [57.50084, -10.31483, 0], [58.4771, -10.11522, 0], [59.4854, -10.01301, 0]]] }]);
});

test('Ellipse', t => {
  const assembly = svgToAssembly({},
                                 `
                                  <?xml version="1.0"?>
                                  <svg width="12cm" height="4cm" viewBox="0 0 1200 400"
                                       xmlns="http://www.w3.org/2000/svg" version="1.2" baseProfile="tiny">
                                    <desc>Example ellipse01 - examples of ellipses</desc>
                                    <!-- Show outline of canvas using 'rect' element -->
                                    <rect x="1" y="1" width="1198" height="398"
                                          fill="none" stroke="blue" stroke-width="2" />
                                    <g transform="translate(300 200)">
                                      <ellipse rx="250" ry="100"
                                            fill="red"  />
                                    </g>
                                    <ellipse transform="translate(900 200) rotate(-30)" 
                                          rx="250" ry="100"
                                          fill="none" stroke="blue" stroke-width="20"  />
                                  </svg>
                                 `);
  writeFileSync('test.ellipse.pdf', pathsToPdf({}, assemblyToPaths(assembly)));
  t.deepEqual(canonicalize(assembly),
              [{ 'paths': [[[0.1, -0.1, 0], [0.12182, -0.1, 0], [0.29434, -0.1, 0], [0.63412, -0.1, 0], [1.13568, -0.1, 0], [1.79353, -0.1, 0], [2.60219, -0.1, 0], [3.55618, -0.1, 0], [4.65001, -0.1, 0], [5.8782, -0.1, 0], [7.23527, -0.1, 0], [8.71572, -0.1, 0], [10.31408, -0.1, 0], [12.02486, -0.1, 0], [13.84258, -0.1, 0], [16.75768, -0.1, 0], [20.96757, -0.1, 0], [25.5065, -0.1, 0], [30.3306, -0.1, 0], [35.396, -0.1, 0], [40.65882, -0.1, 0], [46.07519, -0.1, 0], [54.39169, -0.1, 0], [65.60831, -0.1, 0], [73.92481, -0.1, 0], [79.34119, -0.1, 0], [84.60401, -0.1, 0], [89.6694, -0.1, 0], [94.4935, -0.1, 0], [99.03243, -0.1, 0], [103.24232, -0.1, 0], [106.15742, -0.1, 0], [107.97514, -0.1, 0], [109.68592, -0.1, 0], [111.28428, -0.1, 0], [112.76473, -0.1, 0], [114.1218, -0.1, 0], [115.34999, -0.1, 0], [116.44382, -0.1, 0], [117.39781, -0.1, 0], [118.20647, -0.1, 0], [118.86432, -0.1, 0], [119.36588, -0.1, 0], [119.70566, -0.1, 0], [119.87818, -0.1, 0], [119.9, -0.1, 0], [119.9, -0.12885, 0], [119.9, -0.35415, 0], [119.9, -0.7908, 0], [119.9, -1.42422, 0], [119.9, -2.23982, 0], [119.9, -3.22304, 0], [119.9, -4.3593, 0], [119.9, -5.63402, 0], [119.9, -7.03263, 0], [119.9, -8.54056, 0], [119.9, -10.97552, 0], [119.9, -14.46871, 0], [119.9, -18.1368, 0], [119.9, -21.8632, 0], [119.9, -25.53129, 0], [119.9, -29.02448, 0], [119.9, -31.45944, 0], [119.9, -32.96737, 0], [119.9, -34.36598, 0], [119.9, -35.6407, 0], [119.9, -36.77696, 0], [119.9, -37.76018, 0], [119.9, -38.57578, 0], [119.9, -39.2092, 0], [119.9, -39.64585, 0], [119.9, -39.87115, 0], [119.9, -39.9, 0], [119.87818, -39.9, 0], [119.70566, -39.9, 0], [119.36588, -39.9, 0], [118.86432, -39.9, 0], [118.20647, -39.9, 0], [117.39781, -39.9, 0], [116.44382, -39.9, 0], [115.34999, -39.9, 0], [114.1218, -39.9, 0], [112.76473, -39.9, 0], [111.28428, -39.9, 0], [109.68592, -39.9, 0], [107.97514, -39.9, 0], [106.15742, -39.9, 0], [103.24232, -39.9, 0], [99.03243, -39.9, 0], [94.4935, -39.9, 0], [89.6694, -39.9, 0], [84.60401, -39.9, 0], [79.34119, -39.9, 0], [73.92481, -39.9, 0], [65.60831, -39.9, 0], [54.39169, -39.9, 0], [46.07519, -39.9, 0], [40.65882, -39.9, 0], [35.396, -39.9, 0], [30.3306, -39.9, 0], [25.5065, -39.9, 0], [20.96757, -39.9, 0], [16.75768, -39.9, 0], [13.84258, -39.9, 0], [12.02486, -39.9, 0], [10.31408, -39.9, 0], [8.71572, -39.9, 0], [7.23527, -39.9, 0], [5.8782, -39.9, 0], [4.65001, -39.9, 0], [3.55618, -39.9, 0], [2.60219, -39.9, 0], [1.79353, -39.9, 0], [1.13568, -39.9, 0], [0.63412, -39.9, 0], [0.29434, -39.9, 0], [0.12182, -39.9, 0], [0.1, -39.9, 0], [0.1, -39.87115, 0], [0.1, -39.64585, 0], [0.1, -39.2092, 0], [0.1, -38.57578, 0], [0.1, -37.76018, 0], [0.1, -36.77696, 0], [0.1, -35.6407, 0], [0.1, -34.36598, 0], [0.1, -32.96737, 0], [0.1, -31.45944, 0], [0.1, -29.02448, 0], [0.1, -25.53129, 0], [0.1, -21.8632, 0], [0.1, -18.1368, 0], [0.1, -14.46871, 0], [0.1, -10.97552, 0], [0.1, -8.54056, 0], [0.1, -7.03263, 0], [0.1, -5.63402, 0], [0.1, -4.3593, 0], [0.1, -3.22304, 0], [0.1, -2.23982, 0], [0.1, -1.42422, 0], [0.1, -0.7908, 0], [0.1, -0.35415, 0], [0.1, -0.12885, 0]]] },
               { 'paths': [[[30, -10, 0], [31.2865, -10.01301, 0], [33.80725, -10.11522, 0], [36.24789, -10.31483, 0], [38.59584, -10.6068, 0], [40.83853, -10.98611, 0], [42.96341, -11.44773, 0], [44.9579, -11.98665, 0], [46.80944, -12.59782, 0], [48.50545, -13.27623, 0], [50.03339, -14.01684, 0], [51.38067, -14.81464, 0], [52.26501, -15.44748, 0], [52.79158, -15.88463, 0], [53.26592, -16.33325, 0], [53.68645, -16.79271, 0], [54.05161, -17.26238, 0], [54.35983, -17.74163, 0], [54.60953, -18.22983, 0], [54.79914, -18.72637, 0], [54.9271, -19.2306, 0], [54.99184, -19.7419, 0], [55, -20, 0], [54.99184, -20.2581, 0], [54.9271, -20.7694, 0], [54.79914, -21.27363, 0], [54.60953, -21.77017, 0], [54.35983, -22.25837, 0], [54.05161, -22.73762, 0], [53.68645, -23.20729, 0], [53.26592, -23.66675, 0], [52.79158, -24.11537, 0], [52.26501, -24.55252, 0], [51.38067, -25.18536, 0], [50.03339, -25.98316, 0], [48.50545, -26.72377, 0], [46.80944, -27.40218, 0], [44.9579, -28.01335, 0], [42.96341, -28.55227, 0], [40.83853, -29.01389, 0], [38.59584, -29.3932, 0], [36.24789, -29.68517, 0], [33.80725, -29.88478, 0], [31.2865, -29.98699, 0], [30, -30, 0], [28.7135, -29.98699, 0], [26.19275, -29.88478, 0], [23.75211, -29.68517, 0], [21.40416, -29.3932, 0], [19.16147, -29.01389, 0], [17.03659, -28.55227, 0], [15.0421, -28.01335, 0], [13.19057, -27.40218, 0], [11.49455, -26.72377, 0], [9.96661, -25.98316, 0], [8.61933, -25.18536, 0], [7.73499, -24.55252, 0], [7.20842, -24.11537, 0], [6.73408, -23.66675, 0], [6.31355, -23.20729, 0], [5.94839, -22.73762, 0], [5.64017, -22.25837, 0], [5.39047, -21.77017, 0], [5.20086, -21.27363, 0], [5.0729, -20.7694, 0], [5.00816, -20.2581, 0], [5, -20, 0], [5.00816, -19.7419, 0], [5.0729, -19.2306, 0], [5.20086, -18.72637, 0], [5.39047, -18.22983, 0], [5.64017, -17.74163, 0], [5.94839, -17.26238, 0], [6.31355, -16.79271, 0], [6.73408, -16.33325, 0], [7.20842, -15.88463, 0], [7.73499, -15.44748, 0], [8.61933, -14.81464, 0], [9.96661, -14.01684, 0], [11.49455, -13.27623, 0], [13.19057, -12.59782, 0], [15.0421, -11.98665, 0], [17.03659, -11.44773, 0], [19.16147, -10.98611, 0], [21.40416, -10.6068, 0], [23.75211, -10.31483, 0], [26.19275, -10.11522, 0], [28.7135, -10.01301, 0]]] },
               { 'paths': [[[85, -11.33975, 0], [86.12065, -10.70777, 0], [88.35479, -9.5359, 0], [90.56824, -8.48845, 0], [92.74761, -7.56733, 0], [94.8795, -6.77447, 0], [96.95051, -6.11182, 0], [98.94724, -5.58128, 0], [100.85631, -5.18481, 0], [102.66431, -4.92431, 0], [104.35784, -4.80174, 0], [105.92352, -4.81901, 0], [107.00581, -4.9249, 0], [107.68041, -5.0402, 0], [108.3155, -5.19154, 0], [108.90942, -5.37918, 0], [109.46049, -5.60334, 0], [109.96704, -5.86428, 0], [110.42739, -6.16223, 0], [110.83987, -6.49743, 0], [111.2028, -6.87013, 0], [111.51451, -7.28056, 0], [111.65064, -7.5, 0], [111.77262, -7.72761, 0], [111.97221, -8.20277, 0], [112.1135, -8.70343, 0], [112.19756, -9.22825, 0], [112.22541, -9.77589, 0], [112.19812, -10.34505, 0], [112.11671, -10.93437, 0], [111.98225, -11.54254, 0], [111.79577, -12.16822, 0], [111.55833, -12.81009, 0], [111.10888, -13.80032, 0], [110.341, -15.16488, 0], [109.38808, -16.57023, 0], [108.25849, -18.00576, 0], [106.9606, -19.46082, 0], [105.50277, -20.92478, 0], [103.89339, -22.38699, 0], [102.14082, -23.83683, 0], [100.25342, -25.26366, 0], [98.23957, -26.65684, 0], [96.10763, -28.00574, 0], [95, -28.66025, 0], [93.87935, -29.29223, 0], [91.64521, -30.4641, 0], [89.43176, -31.51155, 0], [87.25239, -32.43267, 0], [85.1205, -33.22553, 0], [83.04949, -33.88818, 0], [81.05276, -34.41872, 0], [79.14369, -34.81519, 0], [77.33569, -35.07569, 0], [75.64216, -35.19826, 0], [74.07648, -35.18099, 0], [72.99419, -35.0751, 0], [72.31959, -34.9598, 0], [71.6845, -34.80846, 0], [71.09058, -34.62082, 0], [70.53951, -34.39666, 0], [70.03296, -34.13572, 0], [69.57261, -33.83777, 0], [69.16013, -33.50257, 0], [68.7972, -33.12987, 0], [68.48549, -32.71944, 0], [68.34936, -32.5, 0], [68.22738, -32.27239, 0], [68.02779, -31.79723, 0], [67.8865, -31.29657, 0], [67.80244, -30.77175, 0], [67.77459, -30.22411, 0], [67.80188, -29.65495, 0], [67.88329, -29.06563, 0], [68.01775, -28.45746, 0], [68.20423, -27.83178, 0], [68.44167, -27.18991, 0], [68.89112, -26.19968, 0], [69.659, -24.83512, 0], [70.61192, -23.42977, 0], [71.74151, -21.99424, 0], [73.0394, -20.53918, 0], [74.49723, -19.07522, 0], [76.10661, -17.61301, 0], [77.85918, -16.16317, 0], [79.74658, -14.73634, 0], [81.76043, -13.34316, 0], [83.89237, -11.99426, 0]]] }]);
});

test('Polygon', t => {
  const assembly = svgToAssembly({},
                                 `
                                  <?xml version="1.0"?>
                                  <svg width="12cm" height="4cm" viewBox="0 0 1200 400"
                                       xmlns="http://www.w3.org/2000/svg" version="1.2" baseProfile="tiny">
                                    <desc>Example polygon01 - star and hexagon</desc>
                                    <!-- Show outline of canvas using 'rect' element -->
                                    <rect x="1" y="1" width="1198" height="398"
                                          fill="none" stroke="blue" stroke-width="2" />
                                    <polygon fill="red" stroke="blue" stroke-width="10" 
                                              points="350,75  379,161 469,161 397,215
                                                      423,301 350,250 277,301 303,215
                                                      231,161 321,161" />
                                    <polygon fill="lime" stroke="blue" stroke-width="10" 
                                              points="850,75  958,137.5 958,262.5
                                                      850,325 742,262.6 742,137.5" />
                                  </svg>
                                 `);
  writeFileSync('test.polygon.pdf', pathsToPdf({}, assemblyToPaths(assembly)));
  t.deepEqual(canonicalize(assembly),
              [{ 'paths': [[[0.1, -0.1, 0], [0.12182, -0.1, 0], [0.29434, -0.1, 0], [0.63412, -0.1, 0], [1.13568, -0.1, 0], [1.79353, -0.1, 0], [2.60219, -0.1, 0], [3.55618, -0.1, 0], [4.65001, -0.1, 0], [5.8782, -0.1, 0], [7.23527, -0.1, 0], [8.71572, -0.1, 0], [10.31408, -0.1, 0], [12.02486, -0.1, 0], [13.84258, -0.1, 0], [16.75768, -0.1, 0], [20.96757, -0.1, 0], [25.5065, -0.1, 0], [30.3306, -0.1, 0], [35.396, -0.1, 0], [40.65882, -0.1, 0], [46.07519, -0.1, 0], [54.39169, -0.1, 0], [65.60831, -0.1, 0], [73.92481, -0.1, 0], [79.34119, -0.1, 0], [84.60401, -0.1, 0], [89.6694, -0.1, 0], [94.4935, -0.1, 0], [99.03243, -0.1, 0], [103.24232, -0.1, 0], [106.15742, -0.1, 0], [107.97514, -0.1, 0], [109.68592, -0.1, 0], [111.28428, -0.1, 0], [112.76473, -0.1, 0], [114.1218, -0.1, 0], [115.34999, -0.1, 0], [116.44382, -0.1, 0], [117.39781, -0.1, 0], [118.20647, -0.1, 0], [118.86432, -0.1, 0], [119.36588, -0.1, 0], [119.70566, -0.1, 0], [119.87818, -0.1, 0], [119.9, -0.1, 0], [119.9, -0.12885, 0], [119.9, -0.35415, 0], [119.9, -0.7908, 0], [119.9, -1.42422, 0], [119.9, -2.23982, 0], [119.9, -3.22304, 0], [119.9, -4.3593, 0], [119.9, -5.63402, 0], [119.9, -7.03263, 0], [119.9, -8.54056, 0], [119.9, -10.97552, 0], [119.9, -14.46871, 0], [119.9, -18.1368, 0], [119.9, -21.8632, 0], [119.9, -25.53129, 0], [119.9, -29.02448, 0], [119.9, -31.45944, 0], [119.9, -32.96737, 0], [119.9, -34.36598, 0], [119.9, -35.6407, 0], [119.9, -36.77696, 0], [119.9, -37.76018, 0], [119.9, -38.57578, 0], [119.9, -39.2092, 0], [119.9, -39.64585, 0], [119.9, -39.87115, 0], [119.9, -39.9, 0], [119.87818, -39.9, 0], [119.70566, -39.9, 0], [119.36588, -39.9, 0], [118.86432, -39.9, 0], [118.20647, -39.9, 0], [117.39781, -39.9, 0], [116.44382, -39.9, 0], [115.34999, -39.9, 0], [114.1218, -39.9, 0], [112.76473, -39.9, 0], [111.28428, -39.9, 0], [109.68592, -39.9, 0], [107.97514, -39.9, 0], [106.15742, -39.9, 0], [103.24232, -39.9, 0], [99.03243, -39.9, 0], [94.4935, -39.9, 0], [89.6694, -39.9, 0], [84.60401, -39.9, 0], [79.34119, -39.9, 0], [73.92481, -39.9, 0], [65.60831, -39.9, 0], [54.39169, -39.9, 0], [46.07519, -39.9, 0], [40.65882, -39.9, 0], [35.396, -39.9, 0], [30.3306, -39.9, 0], [25.5065, -39.9, 0], [20.96757, -39.9, 0], [16.75768, -39.9, 0], [13.84258, -39.9, 0], [12.02486, -39.9, 0], [10.31408, -39.9, 0], [8.71572, -39.9, 0], [7.23527, -39.9, 0], [5.8782, -39.9, 0], [4.65001, -39.9, 0], [3.55618, -39.9, 0], [2.60219, -39.9, 0], [1.79353, -39.9, 0], [1.13568, -39.9, 0], [0.63412, -39.9, 0], [0.29434, -39.9, 0], [0.12182, -39.9, 0], [0.1, -39.9, 0], [0.1, -39.87115, 0], [0.1, -39.64585, 0], [0.1, -39.2092, 0], [0.1, -38.57578, 0], [0.1, -37.76018, 0], [0.1, -36.77696, 0], [0.1, -35.6407, 0], [0.1, -34.36598, 0], [0.1, -32.96737, 0], [0.1, -31.45944, 0], [0.1, -29.02448, 0], [0.1, -25.53129, 0], [0.1, -21.8632, 0], [0.1, -18.1368, 0], [0.1, -14.46871, 0], [0.1, -10.97552, 0], [0.1, -8.54056, 0], [0.1, -7.03263, 0], [0.1, -5.63402, 0], [0.1, -4.3593, 0], [0.1, -3.22304, 0], [0.1, -2.23982, 0], [0.1, -1.42422, 0], [0.1, -0.7908, 0], [0.1, -0.35415, 0], [0.1, -0.12885, 0]]] },
               { 'paths': [[[35, -7.5, 0], [35.00832, -7.52467, 0], [35.07169, -7.71259, 0], [35.19028, -8.06427, 0], [35.3556, -8.55453, 0], [35.67261, -9.49463, 0], [36.17954, -10.99795, 0], [36.72046, -12.60205, 0], [37.22739, -14.10537, 0], [37.5444, -15.04547, 0], [37.70972, -15.53573, 0], [37.82831, -15.88741, 0], [37.89168, -16.07533, 0], [37.9, -16.1, 0], [37.92582, -16.1, 0], [38.12247, -16.1, 0], [38.49052, -16.1, 0], [39.00358, -16.1, 0], [39.9874, -16.1, 0], [41.56065, -16.1, 0], [43.23936, -16.1, 0], [44.8126, -16.1, 0], [45.79642, -16.1, 0], [46.30949, -16.1, 0], [46.67753, -16.1, 0], [46.87418, -16.1, 0], [46.9, -16.1, 0], [46.87935, -16.11549, 0], [46.72202, -16.23348, 0], [46.42759, -16.45431, 0], [46.01714, -16.76215, 0], [45.23008, -17.35244, 0], [43.97148, -18.29639, 0], [42.62852, -19.30361, 0], [41.36992, -20.24756, 0], [40.58286, -20.83785, 0], [40.17241, -21.14569, 0], [39.87798, -21.36652, 0], [39.72065, -21.48451, 0], [39.7, -21.5, 0], [39.70746, -21.52467, 0], [39.76427, -21.71259, 0], [39.87059, -22.06427, 0], [40.01881, -22.55453, 0], [40.30303, -23.49463, 0], [40.75752, -24.99795, 0], [41.24248, -26.60205, 0], [41.69697, -28.10537, 0], [41.98119, -29.04547, 0], [42.12941, -29.53573, 0], [42.23573, -29.88741, 0], [42.29254, -30.07533, 0], [42.3, -30.1, 0], [42.27906, -30.08537, 0], [42.11955, -29.97393, 0], [41.82103, -29.76538, 0], [41.40488, -29.47464, 0], [40.60689, -28.91714, 0], [39.33081, -28.02563, 0], [37.96919, -27.07436, 0], [36.69312, -26.18286, 0], [35.89512, -25.62536, 0], [35.47897, -25.33463, 0], [35.18045, -25.12607, 0], [35.02094, -25.01463, 0], [35, -25, 0], [34.97906, -25.01463, 0], [34.81955, -25.12607, 0], [34.52103, -25.33463, 0], [34.10488, -25.62536, 0], [33.30689, -26.18286, 0], [32.03081, -27.07436, 0], [30.66919, -28.02563, 0], [29.39312, -28.91714, 0], [28.59512, -29.47464, 0], [28.17897, -29.76538, 0], [27.88045, -29.97393, 0], [27.72094, -30.08537, 0], [27.7, -30.1, 0], [27.70746, -30.07533, 0], [27.76427, -29.88741, 0], [27.87059, -29.53573, 0], [28.01881, -29.04547, 0], [28.30303, -28.10537, 0], [28.75752, -26.60205, 0], [29.24248, -24.99795, 0], [29.69697, -23.49463, 0], [29.98119, -22.55453, 0], [30.12941, -22.06427, 0], [30.23573, -21.71259, 0], [30.29254, -21.52467, 0], [30.3, -21.5, 0], [30.27935, -21.48451, 0], [30.12202, -21.36652, 0], [29.82759, -21.14569, 0], [29.41714, -20.83785, 0], [28.63008, -20.24756, 0], [27.37148, -19.30361, 0], [26.02852, -18.29639, 0], [24.76992, -17.35244, 0], [23.98286, -16.76215, 0], [23.57241, -16.45431, 0], [23.27798, -16.23348, 0], [23.12065, -16.11549, 0], [23.1, -16.1, 0], [23.12582, -16.1, 0], [23.32247, -16.1, 0], [23.69052, -16.1, 0], [24.20358, -16.1, 0], [25.1874, -16.1, 0], [26.76065, -16.1, 0], [28.43936, -16.1, 0], [30.0126, -16.1, 0], [30.99642, -16.1, 0], [31.50949, -16.1, 0], [31.87753, -16.1, 0], [32.07418, -16.1, 0], [32.1, -16.1, 0], [32.10832, -16.07533, 0], [32.17169, -15.88741, 0], [32.29028, -15.53573, 0], [32.4556, -15.04547, 0], [32.77261, -14.10537, 0], [33.27954, -12.60205, 0], [33.82046, -10.99795, 0], [34.32739, -9.49463, 0], [34.6444, -8.55453, 0], [34.80972, -8.06427, 0], [34.92831, -7.71259, 0], [34.99168, -7.52467, 0]]] },
               { 'paths': [[[85, -7.5, 0], [85.03098, -7.51793, 0], [85.26697, -7.6545, 0], [85.70862, -7.91008, 0], [86.32429, -8.26637, 0], [87.08235, -8.70506, 0], [87.95115, -9.20784, 0], [89.39277, -10.04211, 0], [91.40723, -11.20789, 0], [92.84885, -12.04216, 0], [93.71765, -12.54494, 0], [94.47571, -12.98363, 0], [95.09138, -13.33992, 0], [95.53303, -13.5955, 0], [95.76902, -13.73207, 0], [95.8, -13.75, 0], [95.8, -13.78586, 0], [95.8, -14.05899, 0], [95.8, -14.57016, 0], [95.8, -15.28274, 0], [95.8, -16.16013, 0], [95.8, -17.16568, 0], [95.8, -18.83423, 0], [95.8, -21.16577, 0], [95.8, -22.83432, 0], [95.8, -23.83987, 0], [95.8, -24.71725, 0], [95.8, -25.42984, 0], [95.8, -25.94101, 0], [95.8, -26.21414, 0], [95.8, -26.25, 0], [95.76902, -26.26793, 0], [95.53303, -26.40449, 0], [95.09138, -26.66008, 0], [94.47571, -27.01637, 0], [93.71765, -27.45506, 0], [92.84885, -27.95784, 0], [91.40723, -28.79211, 0], [89.39277, -29.95789, 0], [87.95115, -30.79216, 0], [87.08235, -31.29494, 0], [86.32429, -31.73363, 0], [85.70862, -32.08992, 0], [85.26697, -32.34551, 0], [85.03098, -32.48207, 0], [85, -32.5, 0], [84.96902, -32.4821, 0], [84.73303, -32.34575, 0], [84.29138, -32.09058, 0], [83.67571, -31.73485, 0], [82.91765, -31.29687, 0], [82.04885, -30.79489, 0], [80.60723, -29.96195, 0], [78.59277, -28.79805, 0], [77.15115, -27.96511, 0], [76.28235, -27.46313, 0], [75.52429, -27.02515, 0], [74.90862, -26.66942, 0], [74.46697, -26.41425, 0], [74.23098, -26.2779, 0], [74.2, -26.26, 0], [74.2, -26.22411, 0], [74.2, -25.95076, 0], [74.2, -25.43918, 0], [74.2, -24.72603, 0], [74.2, -23.84795, 0], [74.2, -22.84159, 0], [74.2, -21.1717, 0], [74.2, -18.8383, 0], [74.2, -17.16841, 0], [74.2, -16.16205, 0], [74.2, -15.28397, 0], [74.2, -14.57082, 0], [74.2, -14.05924, 0], [74.2, -13.78589, 0], [74.2, -13.75, 0], [74.23098, -13.73207, 0], [74.46697, -13.5955, 0], [74.90862, -13.33992, 0], [75.52429, -12.98363, 0], [76.28235, -12.54494, 0], [77.15115, -12.04216, 0], [78.59277, -11.20789, 0], [80.60723, -10.04211, 0], [82.04885, -9.20784, 0], [82.91765, -8.70506, 0], [83.67571, -8.26637, 0], [84.29138, -7.91008, 0], [84.73303, -7.6545, 0], [84.96902, -7.51793, 0]]] }]);
});

test('Complex', t => {
  const assembly = svgToAssembly({},
                                 `
                                  <?xml version="1.0"?>
                                  <svg width="5cm" height="4cm" viewBox="0 0 500 400"
                                       xmlns="http://www.w3.org/2000/svg" version="1.2" baseProfile="tiny">
                                    <title>Example cubic01- cubic Bzier commands in path data</title>
                                    <desc>Picture showing a simple example of path data
                                          using both a "C" and an "S" command,
                                          along with annotations showing the control points
                                          and end points</desc>
                                    <rect fill="none" stroke="blue" stroke-width="1" x="1" y="1" width="498" height="398" />
                                    <polyline fill="none" stroke="#888888" stroke-width="1" points="100,200 100,100" />
                                    <polyline fill="none" stroke="#888888" stroke-width="1" points="250,100 250,200" />
                                    <polyline fill="none" stroke="#888888" stroke-width="1" points="250,200 250,300" />
                                    <polyline fill="none" stroke="#888888" stroke-width="1" points="400,300 400,200" />
                                    <path fill="none" stroke="red" stroke-width="5" d="M100,200 C100,100 250,100 250,200
                                                                         S400,300 400,200" />
                                    <circle fill="#888888" stroke="none" stroke-width="2" cx="100" cy="200" r="10" />
                                    <circle fill="#888888" stroke="none" stroke-width="2" cx="250" cy="200" r="10" />
                                    <circle fill="#888888" stroke="none" stroke-width="2" cx="400" cy="200" r="10" />
                                    <circle fill="#888888" stroke="none" cx="100" cy="100" r="10" />
                                    <circle fill="#888888" stroke="none" cx="250" cy="100" r="10" />
                                    <circle fill="#888888" stroke="none" cx="400" cy="300" r="10" />
                                    <circle fill="none" stroke="blue" stroke-width="4" cx="250" cy="300" r="9" />
                                    <text font-size="22" font-family="Verdana" x="25" y="70">M100,200 C100,100 250,100 250,200</text>
                                    <text font-size="22" font-family="Verdana" x="325" y="350"
                                          text-anchor="middle">S400,300 400,200</text>
                                  </svg>
                                 `);
  writeFileSync('test.complex.pdf', pathsToPdf({}, assemblyToPaths(assembly)));
  t.deepEqual(canonicalize(assembly),
              [{ paths: [[[0.1, -0.1, 0], [0.1361, -0.1, 0], [0.41801, -0.1, 0], [0.96437, -0.1, 0], [1.75694, -0.1, 0], [2.77746, -0.1, 0], [4.00772, -0.1, 0], [5.42947, -0.1, 0], [7.02448, -0.1, 0], [8.7745, -0.1, 0], [10.6613, -0.1, 0], [13.70807, -0.1, 0], [18.07894, -0.1, 0], [22.66867, -0.1, 0], [27.33134, -0.1, 0], [31.92106, -0.1, 0], [36.29193, -0.1, 0], [39.3387, -0.1, 0], [41.2255, -0.1, 0], [42.97552, -0.1, 0], [44.57053, -0.1, 0], [45.99228, -0.1, 0], [47.22254, -0.1, 0], [48.24307, -0.1, 0], [49.03563, -0.1, 0], [49.58199, -0.1, 0], [49.86391, -0.1, 0], [49.9, -0.1, 0], [49.9, -0.12885, 0], [49.9, -0.35415, 0], [49.9, -0.7908, 0], [49.9, -1.42422, 0], [49.9, -2.23982, 0], [49.9, -3.22304, 0], [49.9, -4.3593, 0], [49.9, -5.63402, 0], [49.9, -7.03263, 0], [49.9, -8.54056, 0], [49.9, -10.97552, 0], [49.9, -14.46871, 0], [49.9, -18.1368, 0], [49.9, -21.8632, 0], [49.9, -25.53129, 0], [49.9, -29.02448, 0], [49.9, -31.45944, 0], [49.9, -32.96737, 0], [49.9, -34.36598, 0], [49.9, -35.6407, 0], [49.9, -36.77696, 0], [49.9, -37.76018, 0], [49.9, -38.57578, 0], [49.9, -39.2092, 0], [49.9, -39.64585, 0], [49.9, -39.87115, 0], [49.9, -39.9, 0], [49.86391, -39.9, 0], [49.58199, -39.9, 0], [49.03563, -39.9, 0], [48.24307, -39.9, 0], [47.22254, -39.9, 0], [45.99228, -39.9, 0], [44.57053, -39.9, 0], [42.97552, -39.9, 0], [41.2255, -39.9, 0], [39.3387, -39.9, 0], [36.29193, -39.9, 0], [31.92106, -39.9, 0], [27.33134, -39.9, 0], [22.66867, -39.9, 0], [18.07894, -39.9, 0], [13.70807, -39.9, 0], [10.6613, -39.9, 0], [8.7745, -39.9, 0], [7.02448, -39.9, 0], [5.42947, -39.9, 0], [4.00772, -39.9, 0], [2.77746, -39.9, 0], [1.75694, -39.9, 0], [0.96437, -39.9, 0], [0.41801, -39.9, 0], [0.1361, -39.9, 0], [0.1, -39.9, 0], [0.1, -39.87115, 0], [0.1, -39.64585, 0], [0.1, -39.2092, 0], [0.1, -38.57578, 0], [0.1, -37.76018, 0], [0.1, -36.77696, 0], [0.1, -35.6407, 0], [0.1, -34.36598, 0], [0.1, -32.96737, 0], [0.1, -31.45944, 0], [0.1, -29.02448, 0], [0.1, -25.53129, 0], [0.1, -21.8632, 0], [0.1, -18.1368, 0], [0.1, -14.46871, 0], [0.1, -10.97552, 0], [0.1, -8.54056, 0], [0.1, -7.03263, 0], [0.1, -5.63402, 0], [0.1, -4.3593, 0], [0.1, -3.22304, 0], [0.1, -2.23982, 0], [0.1, -1.42422, 0], [0.1, -0.7908, 0], [0.1, -0.35415, 0], [0.1, -0.12885, 0]]] },
               { paths: [[null, [10, -20, 0], [10, -19.97131, 0], [10, -19.75281, 0], [10, -19.34387, 0], [10, -18.7738, 0], [10, -17.68066, 0], [10, -15.93262, 0], [10, -14.06738, 0], [10, -12.31934, 0], [10, -11.2262, 0], [10, -10.65613, 0], [10, -10.24719, 0], [10, -10.02869, 0], [10, -10, 0]]] },
               { paths: [[null, [25, -10, 0], [25, -10.02869, 0], [25, -10.24719, 0], [25, -10.65613, 0], [25, -11.2262, 0], [25, -12.31934, 0], [25, -14.06738, 0], [25, -15.93262, 0], [25, -17.68066, 0], [25, -18.7738, 0], [25, -19.34387, 0], [25, -19.75281, 0], [25, -19.97131, 0], [25, -20, 0]]] },
               { paths: [[null, [25, -20, 0], [25, -20.02869, 0], [25, -20.24719, 0], [25, -20.65613, 0], [25, -21.2262, 0], [25, -22.31934, 0], [25, -24.06738, 0], [25, -25.93262, 0], [25, -27.68066, 0], [25, -28.7738, 0], [25, -29.34387, 0], [25, -29.75281, 0], [25, -29.97131, 0], [25, -30, 0]]] },
               { paths: [[null, [40, -30, 0], [40, -29.97131, 0], [40, -29.75281, 0], [40, -29.34387, 0], [40, -28.7738, 0], [40, -27.68066, 0], [40, -25.93262, 0], [40, -24.06738, 0], [40, -22.31934, 0], [40, -21.2262, 0], [40, -20.65613, 0], [40, -20.24719, 0], [40, -20.02869, 0], [40, -20, 0]]] },
               { paths: [[null, [10, -20, 0], [10.01087, -19.53857, 0], [10.09579, -18.65967, 0], [10.26035, -17.83936, 0], [10.49908, -17.07764, 0], [10.80647, -16.37451, 0], [11.17703, -15.72998, 0], [11.60526, -15.14404, 0], [12.08569, -14.6167, 0], [12.6128, -14.14795, 0], [13.18111, -13.73779, 0], [13.78513, -13.38623, 0], [14.41937, -13.09326, 0], [15.07832, -12.85889, 0], [15.75649, -12.68311, 0], [16.4484, -12.56592, 0], [17.14855, -12.50732, 0], [17.85145, -12.50732, 0], [18.5516, -12.56592, 0], [19.24351, -12.68311, 0], [19.92168, -12.85889, 0], [20.58064, -13.09326, 0], [21.21487, -13.38623, 0], [21.81889, -13.73779, 0], [22.3872, -14.14795, 0], [22.91431, -14.6167, 0], [23.39474, -15.14404, 0], [23.82298, -15.72998, 0], [24.19354, -16.37451, 0], [24.50092, -17.07764, 0], [24.73965, -17.83936, 0], [24.90421, -18.65967, 0], [24.98913, -19.53857, 0], [25, -20, 0], [25.01087, -20.46143, 0], [25.09579, -21.34033, 0], [25.26035, -22.16065, 0], [25.49908, -22.92236, 0], [25.80647, -23.62549, 0], [26.17703, -24.27002, 0], [26.60526, -24.85596, 0], [27.08569, -25.3833, 0], [27.6128, -25.85205, 0], [28.18111, -26.26221, 0], [28.78513, -26.61377, 0], [29.41937, -26.90674, 0], [30.07832, -27.14111, 0], [30.75649, -27.3169, 0], [31.4484, -27.43408, 0], [32.14855, -27.49268, 0], [32.85145, -27.49268, 0], [33.5516, -27.43408, 0], [34.24351, -27.3169, 0], [34.92168, -27.14111, 0], [35.58064, -26.90674, 0], [36.21487, -26.61377, 0], [36.81889, -26.26221, 0], [37.3872, -25.85205, 0], [37.91431, -25.3833, 0], [38.39474, -24.85596, 0], [38.82298, -24.27002, 0], [39.19354, -23.62549, 0], [39.50092, -22.92236, 0], [39.73965, -22.16065, 0], [39.90421, -21.34033, 0], [39.98913, -20.46143, 0], [40, -20, 0]]] },
               { paths: [[[10, -19, 0], [10.10224, -19.00516, 0], [10.29737, -19.04496, 0], [10.55911, -19.17078, 0], [10.82922, -19.44089, 0], [10.95504, -19.70263, 0], [10.99484, -19.89776, 0], [11, -20, 0], [10.99484, -20.10224, 0], [10.95504, -20.29737, 0], [10.82922, -20.55911, 0], [10.55911, -20.82922, 0], [10.29737, -20.95504, 0], [10.10224, -20.99484, 0], [10, -21, 0], [9.89776, -20.99484, 0], [9.70263, -20.95504, 0], [9.44089, -20.82922, 0], [9.17078, -20.55911, 0], [9.04496, -20.29737, 0], [9.00516, -20.10224, 0], [9, -20, 0], [9.00516, -19.89776, 0], [9.04496, -19.70263, 0], [9.17078, -19.44089, 0], [9.44089, -19.17078, 0], [9.70263, -19.04496, 0], [9.89776, -19.00516, 0]]] },
               { paths: [[[25, -19, 0], [25.10224, -19.00516, 0], [25.29737, -19.04496, 0], [25.55911, -19.17078, 0], [25.82922, -19.44089, 0], [25.95504, -19.70263, 0], [25.99484, -19.89776, 0], [26, -20, 0], [25.99484, -20.10224, 0], [25.95504, -20.29737, 0], [25.82922, -20.55911, 0], [25.55911, -20.82922, 0], [25.29737, -20.95504, 0], [25.10224, -20.99484, 0], [25, -21, 0], [24.89776, -20.99484, 0], [24.70263, -20.95504, 0], [24.44089, -20.82922, 0], [24.17078, -20.55911, 0], [24.04496, -20.29737, 0], [24.00516, -20.10224, 0], [24, -20, 0], [24.00516, -19.89776, 0], [24.04496, -19.70263, 0], [24.17078, -19.44089, 0], [24.44089, -19.17078, 0], [24.70263, -19.04496, 0], [24.89776, -19.00516, 0]]] },
               { paths: [[[40, -19, 0], [40.10224, -19.00516, 0], [40.29737, -19.04496, 0], [40.55911, -19.17078, 0], [40.82922, -19.44089, 0], [40.95504, -19.70263, 0], [40.99484, -19.89776, 0], [41, -20, 0], [40.99484, -20.10224, 0], [40.95504, -20.29737, 0], [40.82922, -20.55911, 0], [40.55911, -20.82922, 0], [40.29737, -20.95504, 0], [40.10224, -20.99484, 0], [40, -21, 0], [39.89776, -20.99484, 0], [39.70263, -20.95504, 0], [39.44089, -20.82922, 0], [39.17078, -20.55911, 0], [39.04496, -20.29737, 0], [39.00516, -20.10224, 0], [39, -20, 0], [39.00516, -19.89776, 0], [39.04496, -19.70263, 0], [39.17078, -19.44089, 0], [39.44089, -19.17078, 0], [39.70263, -19.04496, 0], [39.89776, -19.00516, 0]]] },
               { paths: [[[10, -9, 0], [10.10224, -9.00516, 0], [10.29737, -9.04496, 0], [10.55911, -9.17078, 0], [10.82922, -9.44089, 0], [10.95504, -9.70263, 0], [10.99484, -9.89776, 0], [11, -10, 0], [10.99484, -10.10224, 0], [10.95504, -10.29737, 0], [10.82922, -10.55911, 0], [10.55911, -10.82922, 0], [10.29737, -10.95504, 0], [10.10224, -10.99484, 0], [10, -11, 0], [9.89776, -10.99484, 0], [9.70263, -10.95504, 0], [9.44089, -10.82922, 0], [9.17078, -10.55911, 0], [9.04496, -10.29737, 0], [9.00516, -10.10224, 0], [9, -10, 0], [9.00516, -9.89776, 0], [9.04496, -9.70263, 0], [9.17078, -9.44089, 0], [9.44089, -9.17078, 0], [9.70263, -9.04496, 0], [9.89776, -9.00516, 0]]] },
               { paths: [[[25, -9, 0], [25.10224, -9.00516, 0], [25.29737, -9.04496, 0], [25.55911, -9.17078, 0], [25.82922, -9.44089, 0], [25.95504, -9.70263, 0], [25.99484, -9.89776, 0], [26, -10, 0], [25.99484, -10.10224, 0], [25.95504, -10.29737, 0], [25.82922, -10.55911, 0], [25.55911, -10.82922, 0], [25.29737, -10.95504, 0], [25.10224, -10.99484, 0], [25, -11, 0], [24.89776, -10.99484, 0], [24.70263, -10.95504, 0], [24.44089, -10.82922, 0], [24.17078, -10.55911, 0], [24.04496, -10.29737, 0], [24.00516, -10.10224, 0], [24, -10, 0], [24.00516, -9.89776, 0], [24.04496, -9.70263, 0], [24.17078, -9.44089, 0], [24.44089, -9.17078, 0], [24.70263, -9.04496, 0], [24.89776, -9.00516, 0]]] },
               { paths: [[[40, -29, 0], [40.10224, -29.00516, 0], [40.29737, -29.04496, 0], [40.55911, -29.17078, 0], [40.82922, -29.44089, 0], [40.95504, -29.70263, 0], [40.99484, -29.89776, 0], [41, -30, 0], [40.99484, -30.10224, 0], [40.95504, -30.29737, 0], [40.82922, -30.55911, 0], [40.55911, -30.82922, 0], [40.29737, -30.95504, 0], [40.10224, -30.99484, 0], [40, -31, 0], [39.89776, -30.99484, 0], [39.70263, -30.95504, 0], [39.44089, -30.82922, 0], [39.17078, -30.55911, 0], [39.04496, -30.29737, 0], [39.00516, -30.10224, 0], [39, -30, 0], [39.00516, -29.89776, 0], [39.04496, -29.70263, 0], [39.17078, -29.44089, 0], [39.44089, -29.17078, 0], [39.70263, -29.04496, 0], [39.89776, -29.00516, 0]]] },
               { paths: [[[25, -29.1, 0], [25.18138, -29.11828, 0], [25.5032, -29.25371, 0], [25.74629, -29.4968, 0], [25.88172, -29.81862, 0], [25.9, -30, 0], [25.88172, -30.18138, 0], [25.74629, -30.5032, 0], [25.5032, -30.74629, 0], [25.18138, -30.88172, 0], [25, -30.9, 0], [24.81862, -30.88172, 0], [24.4968, -30.74629, 0], [24.25371, -30.5032, 0], [24.11829, -30.18138, 0], [24.1, -30, 0], [24.11829, -29.81862, 0], [24.25371, -29.4968, 0], [24.4968, -29.25371, 0], [24.81862, -29.11828, 0]]] }
              ]);
});
