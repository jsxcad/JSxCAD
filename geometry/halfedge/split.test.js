import { createNormalize3 } from "@jsxcad/algorithm-quantize";
import fromSurface from "./fromSurface";
import split from "./split";
import test from "ava";
import toPolygons from "./toPolygons";

test("Original", (t) => {
  const normalize = createNormalize3();
  const polygon = [
    [5.010000000000002, 15, 15],
    [-5.01, 15.000000000000002, 15],
    [-14.999999999999998, 15.000000000000004, 15],
    [-15.000000000000004, -14.999999999999998, 15],
    [-5.010000000000002, -15, 15],
    [-5.01, -5.009999999999998, 15],
    [-4.55169697707165, -4.551696977071648, 15],
    [-3.989595767844145, -3.9895957678441447, 15],
    [-3.6768325175923815, -3.676832517592381, 15],
    [-3.5355339059327386, -3.5355339059327373, 15],
    [-4.157348061512727, -2.77785116509801, 15],
    [-4.619397662556434, -1.9134171618254483, 15],
    [-4.903926402016152, -0.9754516100806419, 15],
    [-5, 6.123233995736766e-16, 15],
    [-4.903926402016152, 0.9754516100806431, 15],
    [-4.619397662556434, 1.9134171618254494, 15],
    [-4.157348061512726, 2.777851165098011, 15],
    [-3.5355339059327373, 3.5355339059327378, 15],
    [-2.77785116509801, 4.157348061512726, 15],
    [-1.9134171618254485, 4.619397662556434, 15],
    [-0.975451610080641, 4.903926402016152, 15],
    [3.061616997868383e-16, 5, 15],
    [0.9754516100806416, 4.903926402016152, 15],
    [1.9134171618254492, 4.619397662556434, 15],
    [2.7778511650980113, 4.157348061512726, 15],
    [3.5355339059327378, 3.5355339059327373, 15],
    [4.157348061512726, 2.777851165098011, 15],
    [4.619397662556434, 1.913417161825449, 15],
    [4.903926402016152, 0.9754516100806412, 15],
    [5, 0, 15],
    [4.903926402016151, -0.9754516100806436, 15],
    [4.619397662556432, -1.913417161825452, 15],
    [4.157348061512726, -2.777851165098011, 15],
    [3.535533905932737, -3.5355339059327386, 15],
    [2.777851165098009, -4.157348061512727, 15],
    [1.91341716182545, -4.619397662556433, 15],
    [0.9754516100806415, -4.903926402016152, 15],
    [-9.184850993605148e-16, -5, 15],
    [-0.9754516100806433, -4.903926402016151, 15],
    [-1.9134171618254516, -4.619397662556432, 15],
    [-2.777851165098011, -4.157348061512726, 15],
    [-3.5355339059327386, -3.5355339059327373, 15],
    [-3.6768325175923815, -3.676832517592381, 15],
    [-3.989595767844145, -3.9895957678441447, 15],
    [-4.55169697707165, -4.551696977071648, 15],
    [-5.01, -5.009999999999998, 15],
    [-5.010000000000002, -15, 15],
    [5.01, -15.000000000000004, 15],
    [14.999999999999996, -15.000000000000005, 15],
    [15.000000000000002, 15, 15],
  ];
  const loops = fromSurface([polygon], normalize);
  const splitLoops = split(loops);
  const polygons = toPolygons(splitLoops);
  t.deepEqual(polygons, [
    [
      [-5.010000000000002, -15, 15],
      [5.01, -15.000000000000004, 15],
      [14.999999999999996, -15.000000000000005, 15],
      [15.000000000000002, 15, 15],
      [5.010000000000002, 15, 15],
      [-5.01, 15.000000000000002, 15],
      [-14.999999999999998, 15.000000000000004, 15],
      [-15.000000000000004, -14.999999999999998, 15],
    ],
    [
      [-2.777851165098011, -4.157348061512726, 15],
      [-3.5355339059327386, -3.5355339059327373, 15],
      [-4.157348061512727, -2.77785116509801, 15],
      [-4.619397662556434, -1.9134171618254483, 15],
      [-4.903926402016152, -0.9754516100806419, 15],
      [-5, 6.123233995736766e-16, 15],
      [-4.903926402016152, 0.9754516100806431, 15],
      [-4.619397662556434, 1.9134171618254494, 15],
      [-4.157348061512726, 2.777851165098011, 15],
      [-3.5355339059327373, 3.5355339059327378, 15],
      [-2.77785116509801, 4.157348061512726, 15],
      [-1.9134171618254485, 4.619397662556434, 15],
      [-0.975451610080641, 4.903926402016152, 15],
      [3.061616997868383e-16, 5, 15],
      [0.9754516100806416, 4.903926402016152, 15],
      [1.9134171618254492, 4.619397662556434, 15],
      [2.7778511650980113, 4.157348061512726, 15],
      [3.5355339059327378, 3.5355339059327373, 15],
      [4.157348061512726, 2.777851165098011, 15],
      [4.619397662556434, 1.913417161825449, 15],
      [4.903926402016152, 0.9754516100806412, 15],
      [5, 0, 15],
      [4.903926402016151, -0.9754516100806436, 15],
      [4.619397662556432, -1.913417161825452, 15],
      [4.157348061512726, -2.777851165098011, 15],
      [3.535533905932737, -3.5355339059327386, 15],
      [2.777851165098009, -4.157348061512727, 15],
      [1.91341716182545, -4.619397662556433, 15],
      [0.9754516100806415, -4.903926402016152, 15],
      [-9.184850993605148e-16, -5, 15],
      [-0.9754516100806433, -4.903926402016151, 15],
      [-1.9134171618254516, -4.619397662556432, 15],
    ],
  ]);
});
