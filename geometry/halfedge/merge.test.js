import { createNormalize3 } from "@jsxcad/algorithm-quantize";
import fromSurface from "./fromSurface";
import merge from "./merge";
import test from "ava";
import toPolygons from "./toPolygons";

test("Original", (t) => {
  const normalize = createNormalize3();
  const surface = [
    [
      [-0.02000000000000024, -0.5000000000000001, 0.02000000000000013],
      [-0.5000000000000002, -0.49999999999999994, 0.5],
      [-0.5000000000000002, -0.49999999999999994, -0.5],
      [-0.02000000000000024, -0.5000000000000001, -0.5],
    ],
    [
      [-0.5000000000000002, -0.49999999999999994, 0.5],
      [-0.02000000000000024, -0.5000000000000001, 0.02000000000000013],
      [-0.02000000000000024, -0.5000000000000001, 0.5],
    ],
    [
      [0.5100000000000001, -0.5000000000000001, -0.5],
      [0.5100000000000001, -0.5000000000000001, -0.02000000000000024],
      [0.4999999999999999, -0.5000000000000001, -0.01000000000000001],
      [0.4999999999999999, -0.5000000000000002, -0.5],
    ],
    [
      [0.5100000000000001, -0.5000000000000001, 0.5],
      [0.4999999999999999, -0.5000000000000002, 0.5],
      [0.4999999999999999, -0.5000000000000001, -0.01000000000000001],
      [0.5100000000000001, -0.5000000000000001, -0.02000000000000024],
    ],
    [
      [0.9899999999999999, -0.5000000000000002, -0.5],
      [0.5100000000000001, -0.5000000000000001, -0.02000000000000024],
      [0.5100000000000001, -0.5000000000000001, -0.5],
    ],
    [
      [0.5100000000000001, -0.5000000000000001, -0.02000000000000024],
      [0.9899999999999999, -0.5000000000000002, -0.5],
      [0.9899999999999999, -0.5000000000000002, 0.5],
      [0.5100000000000001, -0.5000000000000001, 0.5],
    ],
    [
      [-0.02000000000000024, -0.5000000000000001, -0.5],
      [-0.010000000000000231, -0.49999999999999994, -0.5],
      [-0.010000000000000231, -0.5000000000000001, 0.01000000000000012],
      [-0.02000000000000024, -0.5000000000000001, 0.02000000000000013],
    ],
    [
      [-0.02000000000000024, -0.5000000000000001, 0.5],
      [-0.02000000000000024, -0.5000000000000001, 0.02000000000000013],
      [-0.010000000000000231, -0.5000000000000001, 0.01000000000000012],
      [-0.010000000000000231, -0.49999999999999994, 0.5],
    ],
    [
      [-0.010000000000000231, -0.49999999999999994, -0.5],
      [0.4999999999999999, -0.5000000000000002, -0.5],
      [-0.010000000000000231, -0.5000000000000001, 0.01000000000000012],
    ],
    [
      [-0.010000000000000231, -0.5000000000000001, 0.01000000000000012],
      [0.4999999999999999, -0.5000000000000002, -0.5],
      [0.4999999999999999, -0.5000000000000002, 0.5],
      [-0.010000000000000231, -0.49999999999999994, 0.5],
    ],
  ];
  const loops = fromSurface(surface, normalize);
  const mergedLoops = merge(loops);
  const polygons = toPolygons(mergedLoops);
  t.deepEqual(polygons, [
    [
      [-0.010000000000000231, -0.49999999999999994, 0.5],
      [-0.02000000000000024, -0.5000000000000001, 0.5],
      [-0.02000000000000024, -0.5000000000000001, 0.02000000000000013],
      [-0.010000000000000231, -0.5000000000000001, 0.01000000000000012],
      [-0.02000000000000024, -0.5000000000000001, 0.02000000000000013],
      [-0.02000000000000024, -0.5000000000000001, 0.5],
      [-0.5000000000000002, -0.49999999999999994, 0.5],
      [-0.5000000000000002, -0.49999999999999994, -0.5],
      [-0.02000000000000024, -0.5000000000000001, -0.5],
      [-0.010000000000000231, -0.49999999999999994, -0.5],
      [0.4999999999999999, -0.5000000000000002, -0.5],
      [0.4999999999999999, -0.5000000000000002, 0.5],
    ],
    [
      [0.5100000000000001, -0.5000000000000001, 0.5],
      [0.4999999999999999, -0.5000000000000002, 0.5],
      [0.4999999999999999, -0.5000000000000001, -0.01000000000000001],
      [0.5100000000000001, -0.5000000000000001, -0.02000000000000024],
      [0.4999999999999999, -0.5000000000000001, -0.01000000000000001],
      [0.4999999999999999, -0.5000000000000002, -0.5],
      [0.5100000000000001, -0.5000000000000001, -0.5],
      [0.9899999999999999, -0.5000000000000002, -0.5],
      [0.9899999999999999, -0.5000000000000002, 0.5],
    ],
  ]);
});
