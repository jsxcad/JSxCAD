import clean from './clean';
import { createNormalize3 } from '@jsxcad/algorithm-quantize';
import fromSurface from './fromSurface';
import test from 'ava';
import toDot from './toDot';
import toPolygons from './toPolygons';

test('Degenerate', t => {
  const normalize = createNormalize3();
  const polygon =
    [
     [-5,6.123233995736766e-16,15],
     [-5.01,-0.10153170387608756,15],
    ];
  const loops = fromSurface([polygon], normalize);
  const cleanedLoops = clean(loops);
  t.deepEqual(cleanedLoops, [undefined]);
});

test('Mysterious', t => {
  const normalize = createNormalize3();
  const polygon =
    [
     [-5.01,1.1826515871311822,15],
     [-5.01,0.6257738198953661,15],
     [-5.01,1.1826515871311822,15],
     [-5,6.123233995736766e-16,15],
     [-5.01,-0.10153170387608756,15],
     [-5,6.123233995736766e-16,15],
    ];
  const loops = fromSurface([polygon], normalize);
  const cleanedLoops = clean(loops);
  t.deepEqual(cleanedLoops, [undefined]);
});

test('Original', t => {
  const normalize = createNormalize3();
  const polygon =
    [
     [3.5355339059327378,3.5355339059327373,15],
     [4.157348061512726,2.777851165098011,15],
     [5.01,1.7388917719518453,15],
     [5.01,2.325470854735758,15],
     [5.01,1.7388917719518453,15],
     [4.157348061512726,2.777851165098011,15],
     [4.619397662556434,1.913417161825449,15],
     [4.903926402016152,0.9754516100806412,15],
     [5,0,15],
     [4.903926402016151,-0.9754516100806436,15],
     [4.619397662556432,-1.913417161825452,15],
     [4.157348061512726,-2.777851165098011,15],
     [3.535533905932737,-3.5355339059327386,15],
     [2.777851165098009,-4.157348061512727,15],
     [1.91341716182545,-4.619397662556433,15],
     [0.9754516100806415,-4.903926402016152,15],
     [-9.184850993605148e-16,-5,15],
     [-0.9754516100806433,-4.903926402016151,15],
     [-1.9134171618254516,-4.619397662556432,15],
     [-2.777851165098011,-4.157348061512726,15],
     [-3.5355339059327386,-3.5355339059327373,15],
     [-3.6768325175923815,-3.676832517592381,15],
     [-3.989595767844145,-3.9895957678441447,15],
     [-4.55169697707165,-4.551696977071648,15],
     [-5.01,-5.009999999999998,15],
     [-5.010000000000002,-15,15],
     [5.01,-15.000000000000004,15],
     [5.01,-5.01,15],
     [-0.10153170387608323,-5.009999999999999,15],
     [-0.6257738198953744,-5.009999999999999,15],
     [-1.1826515871311858,-5.009999999999998,15],
     [-1.738891771951846,-5.009999999999998,15],
     [-2.325470854735763,-5.009999999999998,15],
     [-2.9642396521580308,-5.009999999999998,15],
     [-3.680059528080771,-5.009999999999998,15],
     [-4.506558069180607,-5.009999999999998,15],
     [-3.680059528080771,-5.009999999999998,15],
     [-2.9642396521580308,-5.009999999999998,15],
     [-2.325470854735763,-5.009999999999998,15],
     [-1.738891771951846,-5.009999999999998,15],
     [-1.1826515871311858,-5.009999999999998,15],
     [-0.6257738198953744,-5.009999999999999,15],
     [-0.10153170387608323,-5.009999999999999,15],
     [5.01,-5.01,15],
     [5.01,-4.506558069180606,15],
     [5.01,-3.6800595280807693,15],
     [4.626075236918136,-3.7965218317163876,15],
     [3.9895957678441465,-3.9895957678441447,15],
     [3.416779379163063,-4.163357719666486,15],
     [2.888868771906094,-4.323497651619026,15],
     [2.3915878534569477,-4.474346169051788,15],
     [2.888868771906094,-4.323497651619026,15],
     [3.416779379163063,-4.163357719666486,15],
     [3.9895957678441465,-3.9895957678441447,15],
     [4.626075236918136,-3.7965218317163876,15],
     [5.01,-3.6800595280807693,15],
     [5.01,-0.10153170387608368,15],
     [5.01,0.6257738198953673,15],
     [5.01,1.182651587131181,15],
     [5.01,0.6257738198953673,15],
     [5.01,-0.10153170387608368,15],
     [5.01,-3.6800595280807693,15],
     [5.01,-4.506558069180606,15],
     [5.01,-5.01,15],
     [5.01,-15.000000000000004,15],
     [14.999999999999996,-15.000000000000005,15],
     [15.000000000000002,15,15],
     [5.010000000000002,15,15],
     [-5.01,15.000000000000002,15],
     [-5.01,5.01,15],
     [0.10153170387609833,5.01,15],
     [5.01,5.01,15],
     [4.551696977071651,4.551696977071651,15],
     [3.989595767844148,3.989595767844148,15],
     [3.6768325175923815,3.6768325175923815,15],
     [5.01,2.964239652158028,15],
     [5.01,3.680059528080773,15],
     [5.01,4.506558069180605,15],
     [5.01,3.680059528080773,15],
     [5.01,2.964239652158028,15],
     [3.6768325175923815,3.6768325175923815,15],
     [3.989595767844148,3.989595767844148,15],
     [4.551696977071651,4.551696977071651,15],
     [5.01,5.01,15],
     [0.10153170387609833,5.01,15],
     [-5.01,5.01,15],
     [-5.01,4.506558069180606,15],
     [-5.01,3.6800595280807733,15],
     [-5.01,2.9642396521580254,15],
     [-5.01,2.3254708547357605,15],
     [-5.01,1.7388917719518453,15],
     [-5.01,1.1826515871311822,15],
     [-5.01,0.6257738198953661,15],
     [-5.01,1.1826515871311822,15],
     [-5.01,1.7388917719518453,15],
     [-5.01,2.3254708547357605,15],
     [-5.01,2.9642396521580254,15],
     [-5.01,3.6800595280807733,15],
     [-5.01,4.506558069180606,15],
     [-5.01,5.01,15],
     [-5.01,15.000000000000002,15],
     [-14.999999999999998,15.000000000000004,15],
     [-15.000000000000004,-14.999999999999998,15],
     [-5.010000000000002,-15,15],
     [-5.01,-5.009999999999998,15],
     [-4.55169697707165,-4.551696977071648,15],
     [-3.989595767844145,-3.9895957678441447,15],
     [-3.6768325175923815,-3.676832517592381,15],
     [-3.5355339059327386,-3.5355339059327373,15],
     [-4.157348061512727,-2.77785116509801,15],
     [-4.619397662556434,-1.9134171618254483,15],
     [-4.903926402016152,-0.9754516100806419,15],
     [-5,6.123233995736766e-16,15],
     [-5.01,-0.10153170387608756,15],
     [-5,6.123233995736766e-16,15],
     [-4.903926402016152,0.9754516100806431,15],
     [-4.619397662556434,1.9134171618254494,15],
     [-4.157348061512726,2.777851165098011,15],
     [-3.5355339059327373,3.5355339059327378,15],
     [-2.77785116509801,4.157348061512726,15],
     [-1.9134171618254485,4.619397662556434,15],
     [-0.975451610080641,4.903926402016152,15],
     [3.061616997868383e-16,5,15],
     [0.9754516100806416,4.903926402016152,15],
     [1.9134171618254492,4.619397662556434,15],
     [2.7778511650980113,4.157348061512726,15]
    ];
  const loops = fromSurface([polygon], normalize);
  const cleanedLoops = clean(loops);
  const polygons = toPolygons(cleanedLoops);
  t.deepEqual(
    polygons,
    [[[5.010000000000002,15,15],[-5.01,15.000000000000002,15],[-14.999999999999998,15.000000000000004,15],[-15.000000000000004,-14.999999999999998,15],[-5.010000000000002,-15,15],[-5.01,-5.009999999999998,15],[-4.55169697707165,-4.551696977071648,15],[-3.989595767844145,-3.9895957678441447,15],[-3.6768325175923815,-3.676832517592381,15],[-3.5355339059327386,-3.5355339059327373,15],[-4.157348061512727,-2.77785116509801,15],[-4.619397662556434,-1.9134171618254483,15],[-4.903926402016152,-0.9754516100806419,15],[-5,6.123233995736766e-16,15],[-4.903926402016152,0.9754516100806431,15],[-4.619397662556434,1.9134171618254494,15],[-4.157348061512726,2.777851165098011,15],[-3.5355339059327373,3.5355339059327378,15],[-2.77785116509801,4.157348061512726,15],[-1.9134171618254485,4.619397662556434,15],[-0.975451610080641,4.903926402016152,15],[3.061616997868383e-16,5,15],[0.9754516100806416,4.903926402016152,15],[1.9134171618254492,4.619397662556434,15],[2.7778511650980113,4.157348061512726,15],[3.5355339059327378,3.5355339059327373,15],[4.157348061512726,2.777851165098011,15],[4.619397662556434,1.913417161825449,15],[4.903926402016152,0.9754516100806412,15],[5,0,15],[4.903926402016151,-0.9754516100806436,15],[4.619397662556432,-1.913417161825452,15],[4.157348061512726,-2.777851165098011,15],[3.535533905932737,-3.5355339059327386,15],[2.777851165098009,-4.157348061512727,15],[1.91341716182545,-4.619397662556433,15],[0.9754516100806415,-4.903926402016152,15],[-9.184850993605148e-16,-5,15],[-0.9754516100806433,-4.903926402016151,15],[-1.9134171618254516,-4.619397662556432,15],[-2.777851165098011,-4.157348061512726,15],[-3.5355339059327386,-3.5355339059327373,15],[-3.6768325175923815,-3.676832517592381,15],[-3.989595767844145,-3.9895957678441447,15],[-4.55169697707165,-4.551696977071648,15],[-5.01,-5.009999999999998,15],[-5.010000000000002,-15,15],[5.01,-15.000000000000004,15],[14.999999999999996,-15.000000000000005,15],[15.000000000000002,15,15]]]);
});

/* original
    [
     [3.5355339059327378,3.5355339059327373,15],
     [4.157348061512726,2.777851165098011,15],
     [5.01,1.7388917719518453,15],
     [5.01,2.325470854735758,15],
     [5.01,1.7388917719518453,15],
     [4.157348061512726,2.777851165098011,15],
     [4.619397662556434,1.913417161825449,15],
     [4.903926402016152,0.9754516100806412,15],
     [5,0,15],
     [4.903926402016151,-0.9754516100806436,15],
     [4.619397662556432,-1.913417161825452,15],
     [4.157348061512726,-2.777851165098011,15],
     [3.535533905932737,-3.5355339059327386,15],
     [2.777851165098009,-4.157348061512727,15],
     [1.91341716182545,-4.619397662556433,15],
     [0.9754516100806415,-4.903926402016152,15],
     [-9.184850993605148e-16,-5,15],
     [-0.9754516100806433,-4.903926402016151,15],
     [-1.9134171618254516,-4.619397662556432,15],
     [-2.777851165098011,-4.157348061512726,15],
     [-3.5355339059327386,-3.5355339059327373,15],
     [-3.6768325175923815,-3.676832517592381,15],
     [-3.989595767844145,-3.9895957678441447,15],
     [-4.55169697707165,-4.551696977071648,15],
     [-5.01,-5.009999999999998,15],
     [-5.010000000000002,-15,15],
     [5.01,-15.000000000000004,15],
     [5.01,-5.01,15],
     [-0.10153170387608323,-5.009999999999999,15],
     [-0.6257738198953744,-5.009999999999999,15],
     [-1.1826515871311858,-5.009999999999998,15],
     [-1.738891771951846,-5.009999999999998,15],
     [-2.325470854735763,-5.009999999999998,15],
     [-2.9642396521580308,-5.009999999999998,15],
     [-3.680059528080771,-5.009999999999998,15],
     [-4.506558069180607,-5.009999999999998,15],
     [-3.680059528080771,-5.009999999999998,15],
     [-2.9642396521580308,-5.009999999999998,15],
     [-2.325470854735763,-5.009999999999998,15],
     [-1.738891771951846,-5.009999999999998,15],
     [-1.1826515871311858,-5.009999999999998,15],
     [-0.6257738198953744,-5.009999999999999,15],
     [-0.10153170387608323,-5.009999999999999,15],
     [5.01,-5.01,15],
     [5.01,-4.506558069180606,15],
     [5.01,-3.6800595280807693,15],
     [4.626075236918136,-3.7965218317163876,15],
     [3.9895957678441465,-3.9895957678441447,15],
     [3.416779379163063,-4.163357719666486,15],
     [2.888868771906094,-4.323497651619026,15],
     [2.3915878534569477,-4.474346169051788,15],
     [2.888868771906094,-4.323497651619026,15],
     [3.416779379163063,-4.163357719666486,15],
     [3.9895957678441465,-3.9895957678441447,15],
     [4.626075236918136,-3.7965218317163876,15],
     [5.01,-3.6800595280807693,15],
     [5.01,-0.10153170387608368,15],
     [5.01,0.6257738198953673,15],
     [5.01,1.182651587131181,15],
     [5.01,0.6257738198953673,15],
     [5.01,-0.10153170387608368,15],
     [5.01,-3.6800595280807693,15],
     [5.01,-4.506558069180606,15],
     [5.01,-5.01,15],
     [5.01,-15.000000000000004,15],
     [14.999999999999996,-15.000000000000005,15],
     [15.000000000000002,15,15],
     [5.010000000000002,15,15],
     [-5.01,15.000000000000002,15],
     [-5.01,5.01,15],
     [0.10153170387609833,5.01,15],
     [5.01,5.01,15],
     [4.551696977071651,4.551696977071651,15],
     [3.989595767844148,3.989595767844148,15],
     [3.6768325175923815,3.6768325175923815,15],
     [5.01,2.964239652158028,15],
     [5.01,3.680059528080773,15],
     [5.01,4.506558069180605,15],
     [5.01,3.680059528080773,15],
     [5.01,2.964239652158028,15],
     [3.6768325175923815,3.6768325175923815,15],
     [3.989595767844148,3.989595767844148,15],
     [4.551696977071651,4.551696977071651,15],
     [5.01,5.01,15],
     [0.10153170387609833,5.01,15],
     [-5.01,5.01,15],
     [-5.01,4.506558069180606,15],
     [-5.01,3.6800595280807733,15],
     [-5.01,2.9642396521580254,15],
     [-5.01,2.3254708547357605,15],
     [-5.01,1.7388917719518453,15],
     [-5.01,1.1826515871311822,15],
     [-5.01,0.6257738198953661,15],
     [-5.01,1.1826515871311822,15],
     [-5.01,1.7388917719518453,15],
     [-5.01,2.3254708547357605,15],
     [-5.01,2.9642396521580254,15],
     [-5.01,3.6800595280807733,15],
     [-5.01,4.506558069180606,15],
     [-5.01,5.01,15],
     [-5.01,15.000000000000002,15],
     [-14.999999999999998,15.000000000000004,15],
     [-15.000000000000004,-14.999999999999998,15],
     [-5.010000000000002,-15,15],
     [-5.01,-5.009999999999998,15],
     [-4.55169697707165,-4.551696977071648,15],
     [-3.989595767844145,-3.9895957678441447,15],
     [-3.6768325175923815,-3.676832517592381,15],
     [-3.5355339059327386,-3.5355339059327373,15],
     [-4.157348061512727,-2.77785116509801,15],
     [-4.619397662556434,-1.9134171618254483,15],
     [-4.903926402016152,-0.9754516100806419,15],
     [-5,6.123233995736766e-16,15],
     [-5.01,-0.10153170387608756,15],
     [-5,6.123233995736766e-16,15],
     [-4.903926402016152,0.9754516100806431,15],
     [-4.619397662556434,1.9134171618254494,15],
     [-4.157348061512726,2.777851165098011,15],
     [-3.5355339059327373,3.5355339059327378,15],
     [-2.77785116509801,4.157348061512726,15],
     [-1.9134171618254485,4.619397662556434,15],
     [-0.975451610080641,4.903926402016152,15],
     [3.061616997868383e-16,5,15],
     [0.9754516100806416,4.903926402016152,15],
     [1.9134171618254492,4.619397662556434,15],
     [2.7778511650980113,4.157348061512726,15]
    ];
*/

