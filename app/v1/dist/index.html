<html lang="en">
  <head>
    <title>JSxCAD Viewer</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
    <style>
      body {
        color: #cccccc;
        font-family: Monospace;
        font-size: 13px;
        text-align: left;
        background-color: #050505;
        margin: 0px;
      }
      .CodeMirror { 
        border-top: 1px solid black;
        border-bottom: 1px solid black;
      }
    </style>
  </head>
  <body id="body">
    <textarea id="editor">
let x = union(sphere().as('a').material('metal'),
              cube({ size: 1, center: true }).translate([0.5, 0.5, 0.5]).as('b'),
              cube({ size: 1, center: true }).translate([0.5, 0, 0]).as('c').material('metal'))

clearScreen({path : 'window/viewer/*'});
writeScreen({path : 'window/viewer/x'}, x);
writeScreen({path : 'window/viewer/thing1'}, sphere(2).translate([0, 0, -1.5]));
writeScreen({path : 'window/viewer/thing2'}, cube(2).translate([-2, -2, -0.5]));
clearScreen({path : 'window/viewer/thing1'});

    </textarea>
    <div id="viewer" style = "height: 50%;" style = "width: 100%;"></div>
    <div id="viewer2" height="200"></div>
    <div id="container"></div>

    </textarea>

    <!-- CodeMirror -->
    <link rel="stylesheet" href="https://codemirror.net/lib/codemirror.css">
    <script src="https://codemirror.net/lib/codemirror.js"></script>
    <script src="https://codemirror.net/mode/javascript/javascript.js"></script>

    <!-- ThreeJS -->
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/three.js/87/three.min.js"></script>
    <script type="text/javascript" src="https://cdn.rawgit.com/mrdoob/stats.js/master/build/stats.min.js"></script>
    <script type="text/javascript" src="https://cdn.rawgit.com/mrdoob/three.js/master/examples/js/controls/TrackballControls.js"></script>
    <script type="text/javascript" src="https://cdn.rawgit.com/dataarts/dat.gui/master/build/dat.gui.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/ami.js//0.0.20/ami.min.js"></script>

    <!-- App -->
    <script type="module">

      import { api, readFileSync, trianglesToThreejsDatasets, watchFile, writeFileSync } from './JSxCAD.js';

      let editor;
      const setupCodeMirror = () => {
        editor = CodeMirror.fromTextArea(document.getElementById('editor'),
                                         {
                                           mode: "javascript",
                                           theme: "default",
                                           lineNumbers: true,
                                           gutter: true,
                                           lineWrapping: true,
                                           extraKeys: {
                                             'Shift-Enter': () => {
                                               // Evaluate.
                                               const code = new Function('$',
                                                                         `const { ${Object.keys(api).join(', ')} } = $;\n\n` + 
                                                                         editor.getDoc().getValue('\n'));
                                               const result = code(api);
                                             }
                                           }
                                         });
      };
      document.addEventListener("DOMContentLoaded", setupCodeMirror);
      
    </script>
  </body>
</html>
