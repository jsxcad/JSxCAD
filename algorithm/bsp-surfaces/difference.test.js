import { canonicalize, fromPolygons, transform } from '@jsxcad/geometry-solid';

import { boot } from '@jsxcad/sys';
import { difference } from './difference';
import { fromTranslation } from '@jsxcad/math-mat4';
import test from 'ava';

const cubePolygons = [[[-1, -1, -1], [-1, -1, 1], [-1, 1, 1], [-1, 1, -1]],
                      [[1, -1, -1], [1, 1, -1], [1, 1, 1], [1, -1, 1]],
                      [[-1, -1, -1], [1, -1, -1], [1, -1, 1], [-1, -1, 1]],
                      [[-1, 1, -1], [-1, 1, 1], [1, 1, 1], [1, 1, -1]],
                      [[-1, -1, -1], [-1, 1, -1], [1, 1, -1], [1, -1, -1]],
                      [[-1, -1, 1], [1, -1, 1], [1, 1, 1], [-1, 1, 1]]];

test.beforeEach(async t => { await boot(); });

test('Self difference', t => {
  const solid = difference(fromPolygons({}, cubePolygons), fromPolygons({}, cubePolygons));
  t.deepEqual(canonicalize(solid),
              []);
});

test('Overlapping difference', t => {
  const solid = difference(transform(fromTranslation([0.5, 0.5, 0.5]), fromPolygons({}, cubePolygons)),
                           fromPolygons({}, cubePolygons));
  t.deepEqual(canonicalize(solid),
              [[[[-0.5, -0.5, 1.01], [-0.5, -0.5, 1.5], [-0.5, 1.5, 1.5], [-0.5, 1.5, 1.01]], [[-0.5, 1.5, 1.01], [-0.5, 1.5, -0.5], [-0.5, 1.01, -0.5], [-0.5, 1.01, 1.01]], [[-0.5, 1.01, 1.01], [-0.5, 1.01, -0.5], [-0.5, 1, -0.5], [-0.5, 1, 1.01]], [[-0.5, 1, 1.01], [-0.5, 1, 1], [-0.5, -0.5, 1], [-0.5, -0.5, 1.01]]], [[[1.5, -0.5, 1.5], [1.5, -0.5, 1.01], [1.5, 1.5, 1.01], [1.5, 1.5, 1.5]], [[1.5, -0.5, 1.01], [1.5, -0.5, -0.5], [1.5, 1.5, -0.5], [1.5, 1.5, 1.01]]], [[[-0.5, -0.5, 1.5], [-0.5, -0.5, 1.01], [1.5, -0.5, 1.01], [1.5, -0.5, 1.5]], [[1.5, -0.5, 1.01], [1.01, -0.5, 1.01], [1.01, -0.5, -0.5], [1.5, -0.5, -0.5]], [[1.01, -0.5, 1], [1.01, -0.5, 1.01], [-0.5, -0.5, 1.01], [-0.5, -0.5, 1]], [[1, -0.5, -0.5], [1.01, -0.5, -0.5], [1.01, -0.5, 1], [1, -0.5, 1]]], [[[-0.5, 1.5, 1.01], [-0.5, 1.5, 1.5], [1.5, 1.5, 1.5], [1.5, 1.5, 1.01]], [[1.5, 1.5, 1.01], [1.5, 1.5, -0.5], [1.01, 1.5, -0.5], [1.01, 1.5, 1.01]], [[1.01, 1.5, -0.5], [-0.5, 1.5, -0.5], [-0.5, 1.5, 1.01], [1.01, 1.5, 1.01]]], [[[-0.5, -0.5, 1.5], [1.5, -0.5, 1.5], [1.5, 1.5, 1.5], [-0.5, 1.5, 1.5]]], [[[1.5, -0.5, -0.5], [1.01, -0.5, -0.5], [1.01, 1.5, -0.5], [1.5, 1.5, -0.5]], [[1.01, 1.5, -0.5], [1.01, 1.01, -0.5], [-0.5, 1.01, -0.5], [-0.5, 1.5, -0.5]], [[-0.5, 1.01, -0.5], [1.01, 1.01, -0.5], [1.01, 1, -0.5], [-0.5, 1, -0.5]], [[1, 1, -0.5], [1.01, 1, -0.5], [1.01, -0.5, -0.5], [1, -0.5, -0.5]]], [[[1, -0.5, -0.5], [1, -0.5, 1], [1, 1, 1], [1, 1, -0.5]]], [[[-0.5, 1, -0.5], [1, 1, -0.5], [1, 1, 1], [-0.5, 1, 1]]], [[[-0.5, -0.5, 1], [-0.5, 1, 1], [1, 1, 1], [1, -0.5, 1]]]]);
});
